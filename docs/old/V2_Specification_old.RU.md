# V2 Specification

This file contains detailed specifications for FastMediaSorter v2, corresponding to the plan items in Version2_todo.md.

## Phase 1: Discovery and Specification

### 1.1. Define Core Concept & Goals

#### TERMS:

Словарь применяемой в спецификации терминологии:

**Иконка файла** - краткая репрезентация в виде изображения. Маленькая в списке или большая в таблице при изображении некоторого числа файлов рядом друг с другом.

**Типы медиафайлов** - изображение, аудио, видео, анимация.

**Изображение (картинка)** - статическое изображение из пула распространённых форматов графических файлов (JPEG, PNG). Краткая репрезентация (иконка файла) - уменьшенный вариант с сохранением пропорций. Информация о файле: расположение, имя, расширение, размер, дата создания, размеры.

**Анимация** - файл GIF. Краткая репрезентация (иконка файла) - уменьшенный первый кадр. Информация о файле: расположение, имя, размер, дата создания, число кадров, размеры.

**Аудиофайл** - аудио из пула распространённых форматов (MP3, WAV). Краткая репрезентация (иконка файла) - картинка, отображающая расширение файла. Информация о файле: расположение, имя, расширение, размер, дата создания, длительность, битрейт.

**Видеофайл** - видео из пула распространённых форматов (MP4, WEBM, MOV, MKV). Может иметь аудиодорожку или нет. Краткая репрезентация (иконка файла) - уменьшенный первый кадр с сохранением пропорций. Информация о файле: расположение, имя, расширение, размер, дата создания, длительность, видеокодек, разрешение.

**Медиафайлы (медиа)** - все файлы из вышеперечисленных групп, которые поддерживает программа.

**Папка (ресурс)** - существующая [локальная папка Android] ИЛИ [сетевая папка во внутренней локальной сети устройства] ИЛИ [папка на виртуальном диске пользователя в облаке (Google Drive, OneDrive и т.п.)] ИЛИ [SFTP Folder], которая потенциально может содержать медиафайлы. Эту папку (ресурс) пользователь зарегистрировал в программе вручную или программа нашла/добавила при сканировании. О каждой зарегистрированной в программе папке (ресурсе) мы должны хранить:
1.  тип (локальная, сетевая, облачная, другая)
2.  адрес и условия доступа к ресурсу (по-разному для типов файлов)
3.  информацию авторизации (пользователь, пароль)
4.  короткое название (имя ресурса) (для отображения в списках и на кнопках сортировки)
5.  типы медиафайлов, с которыми программа будет работать внутри (несколько boolean значений)
6.  имя последнего выбранного или проигранного медиафайла (для возобновления просмотра с того же места при следующем открытии)
7.  число медиафайлов внутри (при последнем открытии или сканировании)
8.  установленный интервал для слайд-шоу медиафайлов папки (ресурса)
9.  флаг о том, что ресурс также является destination
10. порядок в списке destinations, если ресурс также является destination
11. дата создания ресурса
12. дата последнего сканирования ресурса или работы с ним
13. Режим сортировки для этого ресурса. По умолчанию берется из настроек, но во время проигрывания медиафайлов ресурса или при редакции профиля ресурса, пользователь может указать иное значение для этой папки.
14. Режим оторажения ресурса (список, сетка). Берется по умолчанию из настроек, но пользователь может выбрать при редакции ресурса или во время просмотра ресурса
15. Установленные для этого ресурса размер ячейки сетки. Может быть задан при редакции ресурса. Если нет - берётся значение по умолчанию из настроек.

**Отбор файлов** - в программе отбор должен быть реализован за счёт:
1.  расширения файла (принадлежит типу медиа). В программе могут быть отключены видео, аудио и анимация. В таком случае любое упоминание о них также убрано из интерфейса, пока пользователь их не включит.
2.  размера (отдельно заданные лимиты для видеофайлов, аудиофайлов, анимации, изображений).
3.  даты создания.

**Сортировка медиафайлов** - порядок представления файлов в списке или порядок при слайд-шоу:
1.  По наименованию (по алфавиту)
2.  Обратно по наименованию (по обратному алфавиту)
3.  По логике наименования: это когда порядок Image1, Image2, Image3, .. Image10 (в случае с обычным по-алфавиту Image10 был бы сразу за Image1)
4.  По размеру
5.  Обратно по размеру
6.  По дате создания
7.  Обратно по дате создания
8.  По длительности (для видео и аудио)
9.  Обратно по длительности (для видео и аудио)
10. Случайно (перемешанный порядок)

**Destinations (получатели)** - список папок (ресурсов) до 10 папок, выбранных из числа тех, которые зарегистрированы в программе, которые доступны пользователю и программе для записи. Пользователь сам выбрал их из числа зарегистрированных папок (ресурсов) или добавил в список получателей сразу при регистрации новой папки (ресурса). Используются в качестве получателей при операциях копирования и перемещения медиафайлов.

**Проигрыватель (проигрывание)** - демонстрация медиафайлов в текущей выбранной папке (ресурсе) в их естественном виде (просмотр, прослушивание).

**Слайд-шоу** - проигрывание медиафайлов с переходом к следующему файлу по расписанию. Например, раз в 10 секунд. Опционально условие с расписанием может быть дополнено длительностью для видео и аудио медиафайлов. То есть будет такая опция, при которой файл проигрывается до конца его длительности перед переходом к следующему файлу.

**Сортировка** - список операций, которые пользователь может применить к одному файлу (копирование, перемещение, удаление, переименование) или к выбранным файлам из списка (копирование, перемещение, удаление). Для копирования и перемещения нужно предложить все допустимые Destinations.

**Отмена** - сложно организованная операция отмены последней операции. Наличие этой команды в интерфейсе - опция в настройках. Зависит от предыдущей операции. Переход к следующему файлу, смена папки или выход из Activity - это тоже операции.
1.  Если последняя операция - копирование, это значит попытаться удалить копию на получателе.
2.  Если последняя операция - перенос, попытаться перенести файл обратно.
3.  При операции удаления не производить физическое удаление файла сразу. Ждать следующей команды. Если следующая команда не "Отмена", тогда удалять файл. Если следующая команда "Отмена", то "забыть" о команде "Удалить", которая, по-видимому, была ошибочной.
4.  Для переименования - попытаться вернуть оригинальное имя. Также, если следующая команда после переименования была не "Отмена", то можно забыть оригинальное имя последнего переименованного файла.

**Область отображения медиафайлов** - область экрана, в которой проигрывается текущий медиафайл. Это может быть полный экран или часть экрана, окруженная контролами управления (кнопками).

**Поворот** - статические изображения во время отображения можно повернуть на 90 градусов по горизонтали. Все медиафайлы, в том числе повёрнутые изображения, должны быть максимально растянуты в области отображения. Но важно всегда сохранять оригинальные пропорции файла.

**"Назад"** - типичная для Android кнопка перехода назад к предыдущему Activity.

**Всплывающее окно** - элемент мгновенного сообщения, которое отображается несколько секунд (в зависимости от длины текста).

**Диалог** - появляющееся окно с информацией и кнопками, которое ожидает решения пользователя. Это может быть вопрос с вариантами Да/Нет/Отмена. Информация может быть короткой или длинной (доступной для копирования). Могут быть реализованы оригинальные кнопки (например, "скопировать текст диалога в буфер обмена").

---

#### The primary goals for v2.:
Основная концепция новой версии программы - программа-проигрыватель медиафайлов с возможностью сортировки. Для видео, аудиофайлов, файлов анимации и статических изображений (в том числе режим слайд-шоу).

Работа с программой должна быть интуитивно понятна и проста. Программа должна предугадывать и подсказывать пользователю каждый шаг. Как минимум, при первых стартах.

В новой версии программы нет отдельных окон для режимов сортировки и слайд-шоу. В одном окне пользователь может просматривать файлы с различными условиями отбора и сортировки со сменой (листанием к следующему/предыдущему файлу) в автоматическом режиме по расписанию или вручную. И тут же принимать решение по их сортировке (копирование, перемещение, удаление, переименование), если это доступно.

Список медиапапок (ресурсов) общий (локальные и сетевые объединены).

Перечень "получателей" для копирования или перемещения также общий и так же ограничен 10 элементами, как в версии 1.

Также важное нововведение в версии 2 - работа со списком медиафайлов. Список имеет два вида: в виде иконок медиафайлов, расположенных сеткой (таблицей с динамическим числом элементов) (зависит от настроек и оригинального размера экрана устройства), и второй вариант - список (по файлу на строку) с очень уменьшенным изображением, но с детальной информацией о файле в строке описания. Видео и анимация представлены первым кадром, аудиофайлы - иконкой по имени расширения файла. Пользователь может выбирать несколько медиафайлов из списка для задач сортировки.
При работе со списком пользователь может производить отбор и сортировку в нём по параметрам файлов - имя, расширение, размер, дата создания, длительность видео.

Программа должна поддерживать сразу темную и светлую цветовые схемы устройства.

Программа должна поддерживать опционально операцию "отмены".

Хотелось бы подавить необходимость вызывать диалог Android при удалении или перемещении файлов в локальных папках устройства, если пользователь уже разрешил работать с локальными папками. Вероятно, для этого нужно запросить какие-то дополнительные разрешения при первом добавлении этих папок?

Несмотря на работу областей нажатия (управления изображениями) (слева, справа, по углам), хотелось бы также предусмотреть инструмент зума (по щипку) для статических изображений и видеофайлов.

#### Problems the new UI/UX will solve compared to v1
В первой версии пользователь путался между папками в сети и локальными, ему необходимо было между ними переходить, хотя по логике у него одни и те же задачи над ними. Отдельные кнопки "сортировка" и "слайд-шоу" тоже несколько смущают. Нет возможности просматривать и сортировать файлы списком. Мало возможностей по сортировке и отбору файлов для задач. В программе первой версии много ошибок или логических нестыковок при переходе между Activity.

#### Which features to keep, discard, or redesign.
Программа должна сохранить и улучшить систему сбора всевозможных ошибок и сбора данных для отладки. В программе должны комбинироваться два подхода - полное логирование для debug-версии, логирование критических ошибок в release-версии. Нужно сохранить возможность получить логи текущей сессии и логи "последние 3 сессии, но не больше 512 строк", как это реализовано в версии 1. При добавлении папки нужно иметь возможность "протестировать соединение" и получить текст о статусе такого соединения с папкой и короткой информации о папке (ресурсе) (уровень доступа, наличие медиафайлов по типам).

Программа должна поддерживать три языка: английский, русский, украинский с установкой языка системы при первом запуске. Если язык системы другой - то английский. Но пользователь может выбрать язык в настройках. Все сообщения и тексты программы должны быть продублированы на указанных языках.

Неплохое решение по управлению слайд-шоу за счёт "областей нажатия" (слева, справа и по углам медиафайла). Когда пользователь видит изображение на полный экран или в области отображения и управляет навигацией (следующий/предыдущий) и ориентацией изображения.

Нормально реализованы операции по копированию/перемещению медиафайлов - программно сгенерированные кнопки (большие или маленькие), названные и окрашенные в зависимости от доступных папок "получателей". Хочется по-прежнему максимально экономить пространство экрана, оставляя его для медиафайлов или списков медиафайлов.

Неплохо иметь Welcome screen. Возможно, 7 страниц (в версии 1) это слишком много. Уместить всё нужное, наверное, можно в 3-5 страниц. Но важно рассказать об основных возможностях программы и первых шагах её использования.

Хочу сохранить механизм "предварительного кэширования" следующего медиафайла для режима слайд-шоу (проигрывателя).

Нужно будет оставить возможность сканирования локальных папок Android с медиафайлами для добавления в список папок с демонстрацией количества медиафайлов. Если папка уже была зарегистрирована, а теперь количество их ноль, то это не значит, что папку нужно удалять из списка зарегистрированных в программе или из списка "получателей".

Также хорошо сканировать открытые папки по IP устройства - с определением права на запись, исключая системные ресурсы (shares).

Exoplayer - хороший выбор. Нужно обрабатывать его ошибки, в том числе при работе с медиафайлами в нестабильной сети. Может ли он проигрывать аудиофайлы?

---

### 1.2. UI/UX Design

#### Welcome Screen
Запускается при первом запуске программы после установки и по кнопке из экрана настроек.
Выглядит как сменяющиеся несколько страниц с инструкциями и описанием программы. Есть кнопка "Skip", которая закрывает это окно, даже если пользователь не пролистал его до конца.

#### Main Screen
Основной экран программы.
На нём пользователю видны и доступны следующие элементы (в зависимости от настроек):

1.  Список зарегистрированных "папок" (ресурсов). В этом списке каждый ресурс должен быть представлен в виде строки, содержащей:
    * короткое имя ресурса,
    * полный адрес ресурса (очень мелким шрифтом),
    * тип ресурса,
    * число медиафайлов ресурса (определенное при добавлении или при последнем открытии в Browse Screen или последнем сканировании),
    * отметка, если ресурс также в списке destinations
    * коротко по первым буквам о типах медиафайлов, которые пользователь определил для папки ("I"mage, "V"ideo, "A"udio, "G"if (animations)),
    * кнопка открытия "экрана профиля ресурса" для его редактирования (в виде иконки "edit")
    * кнопки "вверх" и "вниз" (в виде иконок "стрелочек") для перемещения позиции ресурса в списке,
    * кнопка удаления папки (ресурса) из списка (в виде иконки "мусорная корзина")

    Размер списка папок (ресурсов) должен быть динамический. Сначала он будет пустой, но когда он не будет помещаться на экран с учетом прочих элементов, он должен иметь полосу прокрутки.

    В списке папок (ресурсов) может быть выбран только один. После открытия Main Screen должен быть подсвечен последний выбранный ресурс. Если ресурс был удален, никакой ресурс не должен быть выбран. Пользователю нужно его выбрать.

    Кнопка удаления ресурса из списка должна вызывать диалог "Вы согласны удалить ресурс?" или (если это так) "Вы согласны удалить destination?". Если пользователь ответил "ДА", то запись об этом ресурсе удаляется.

    Если пользователь коротко нажимает на строку папки (ресурса), то он просто подсвечивается и становится выбранным. Как только у нас есть выбранная папка-ресурс, кнопки "Запустить проигрыватель" и "Копирование ресурса" становятся активны (enabled).

    Если пользователь "долго нажимает на ресурс" (длинное нажатие), он вызывает Browse Screen для этого ресурса.

    Если пользователь "дважды нажимает на ресурс" (двойной клик), он вызывает Browse Screen для этого ресурса.

    Если новый ресурс в список был только что добавлен вручную, он должен быть сразу выбран. Если добавленные ресурсы - это результаты работы сканирования, то они не должны быть выбраны автоматически.

    Важно помнить, что практически все вызываемые отсюда экраны могут изменить состав и данные этого экрана во время своего закрытия.

2.  Кнопки управления этим списком папок (ресурсов). Расположены в одну строку над списком, которая занимает 100% ширины:
    * Кнопка "Запустить проигрыватель" в виде иконки "PLAY" двойного размера.
        Вызывает Browse Screen для выбранного ресурса.
        Если ни один ресурс не выбран в списке, то кнопка "Запустить проигрыватель" неактивна (disabled).
    * Кнопка "Добавление ресурса" в виде иконки "большой Плюс".
        Вызывает "экран добавления и сканирования ресурсов".
    * Кнопка "Копирование ресурса" в виде иконки "копирование".
        Вызывает "экран добавления и сканирования ресурсов" с учетом выбранного ресурса.
        Если ни один ресурс не выбран в списке, то кнопка "Копирование ресурса" неактивна (disabled).
        В отличие от кнопки "создания" при копировании все значения для нового ресурса берутся с текущего выбранного ресурса из списка. Пользователю необходимо только задать изменения (отличия от оригинала).
    * Небольшой пробел между кнопками.
    * Кнопка "фильтр и сортировка" в виде иконки "фильтр".
        Вызывает "экран фильтрации и сортировки списка папок ресурсов".
        При применении фильтра на основном экране внизу появляется предупреждение с текстом описания примененного фильтра.
    * Кнопка "обновить" в виде иконки "обновить".
        Вызывает процедуру обновления (пересканирования существующих папок).
    * Небольшой пробел между кнопками.
    * Кнопка перехода к Settings Screen в виде иконки "Settings".
        Вызывает Settings Screen.
    * Кнопка выхода из программы (её закрытия) в виде иконки "Exit Door".

#### Экран добавления и сканирования ресурсов
На этом экране пользователь должен ввести детали новой записи о папке-ресурсе.
При копировании из существующего ресурса все значения для нового ресурса берутся с текущего выбранного ресурса из списка. Пользователю необходимо только задать изменения (отличия от оригинала). То есть при копировании тип ресурса не меняется.

Элементы:
1.  Кнопка "Назад", для отмены добавления и возврата на "Main Screen".

2.  Выбор типа ресурса.
    Для этого нужен удобный элемент интерфейса:
    * опция "Локальная папка" (доступна для нажатия, если пользователь дал право на локальные папки, иначе просто видна, но неактивна)
    * опция "Сетевая папка"
    * опция "Облачная папка"
    * опция "SFTP" (доступна для нажатия, если пользователь дал право на связь с интернетом)

3.  Затем, ниже, в зависимости от типа ресурса будут различные элементы:

    **3.1 Для локальной папки:**

    3.1.1 Кнопка с иконкой лупы и надписью "SCAN" и текстом описания рядом "Добавить все локальные папки с медиа".
    Вызывает процедуру сканирования доступных локальных папок с наличием медиафайлов. Найденные ресурсы попадают в список "ресурсы к добавлению".
    Есть предопределённые папки Android - Download, photos, movies, Camera. Нужно определить, какие есть на этом устройстве. Если этих предопределенных папок ещё нет в списке ресурсов (например, при сканировании впервые), то их нужно добавить в список "ресурсы к добавлению", даже если внутри них нет медиафайлов.
    Остальные папки устройства нужно просканировать на наличие медиафайлов и, если они есть, добавить в список "ресурсы к добавлению" с названием папки (например, от Telegram или Whatsapp). Нужно проверять, что папки, которые добавляются к списку "ресурсы к добавлению", ещё не зарегистрированы в списке папок (ресурсов).

    Во время сканирования появляется всплывающее сообщение "Сканирование локальных папок...".
    Во время сканирования определяется количество медиафайлов в папке.
    Во время сканирования определяется право на запись в эту папку.

    3.1.2 Кнопка с иконкой "выбора папки" и надписью "добавить вручную" и текстом описания "Указать папку вручную".
    При вызове этой кнопки нужен диалог Android для выбора локальной папки. Если пользователь выбрал папку в диалоге, ниже кнопки должен появиться "Список папок (ресурсов) к добавлению".
    В этот список одну за другой пользователь может добавлять кнопкой "выбора папки" разные папки.

    После выбора папки для ресурса определяется количество медиафайлов в папке.
    После выбора папки для ресурса определяется наличие права на запись в эту папку.

    3.1.3 После работы сканирования или при успешном закрытии диалога "выбор папки" (при выбранной папке) ниже должен появиться (пополниться) "Список папок (ресурсов) к добавлению".
    Список состоит из найденных при сканировании или добавленных вручную ресурсов. Он состоит из набора следующих полей:
    * галочка "Добавить". Пользователь может снять её, если не хочет добавить этот ресурс, по умолчанию она включена.
    * короткое название из имени папки, которое пользователь может отредактировать.
    * количество найденных медиафайлов внутри.
    * галочка "В destinations", но только для папок, которые доступны для записи. По умолчанию она выключена. Пользователь может установить её вручную для каждой строки списка перед следующим шагом.

    После работы сканирования или ручного добавления папок, если список не пустой, под списком появляется кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".

    По нажатию этой кнопки в список папок (ресурсов) программы добавляются все невыключенные пользователем ресурсы из списка "к добавлению" с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы передаем в главный экран необходимость вывести предупреждения.
    После чего возврат в "Main Screen".

    **3.2 Для сетевой папки (в локальной сети):**

    3.2.1 Поле для ввода IP машины.
    Поле должно быть заполнено автоматически по данным IP этого Android-устройства. Например, если IP 192.168.1.100, то мы пользователю сразу заполняем поле как "192.168.1." с курсором в конце строки. В поле пользователь может вносить только цифры и точку. Но если он вводит запятую - распознается сразу как точка. Если он вводит любые другие символы - они игнорируются. Если он вводит четвертую точку - ввод игнорируется. Если он пытается ввести четырехзначное число - ввод блокируется. В общем, нужно удобное поле ввода IP-адреса. Ссылка "помощи к полю" должна вести на поисковик Google сразу со строкой "Как определить IP моего компьютера во внутренней сети?".

    3.2.2 В одну строку поля "пользователь" и "пароль".
    Если поля пустые, то программа принимает пользователя и пароль, введённые в настройках программы. Если в настройках программы нет сохраненных пользователя и пароля - поля нужно подчеркнуть красным, потребовать от пользователя их ввести.

    3.2.3 Кнопка "Тест" для проверки доступа к IP.
    В результате пользователь получает диалог с подробным описанием сетевого доступа к данному IP. У этого диалога, помимо кнопки ОК, есть кнопка "скопировать в буфер" для текста диагностики.

    3.2.4 В той же строке с кнопкой "Тест", ещё одна - Кнопка с иконкой лупы и надписью "SCAN" и текстом описания рядом "Добавить все открытые сетевые папки с этого компьютера".

    Вызывает процедуру сканирования доступных сетевых папок, независимо от наличия в них медиафайлов. Найденные ресурсы попадают в список "ресурсы к добавлению", если этих папок ещё нет в списке ресурсов программы.
    Предопределённые административные папки (типа $C) игнорируются.

    Во время сканирования появляется всплывающее сообщение "Сканирование сетевых папок...".
    Во время сканирования определяется количество медиафайлов в папке.
    Во время сканирования определяется право на запись в эту папку.

    3.2.5 Третья кнопка в той же строке с иконкой "выбора папки" и надписью "добавить вручную" и текстом описания "Указать папку вручную".
    При вызове этой кнопки нужен диалог для ввода текстового значения адреса папки. С кнопками "Добавить" и "Отмена".
    В диалоге должно быть понятно, что IP-адрес уже не нужно вводить и какие-либо прямые или обратные слеши. В диалоге выгодно сделать выпадающий список с именами папок, найденными на этом компьютере. Но пользователь, вероятнее всего, захочет ввести подпапку или адрес вручную.
    Так, например, если пользователь регистрирует новый ресурс "192.168.1.100\Common\Images", то текст "192.168.1.100\" должен быть информационным заголовком, текст "Common\" может выпадать в качестве одной из папок, найденных на этом компьютере. А текст "Images" пользователь уже должен ввести сам.

    После того, как пользователь указал папку в диалоге, который он закрывает кнопкой "Добавить", ресурс должен появиться в списке "Список папок (ресурсов) к добавлению".
    В этот список одну за другой пользователь может добавлять кнопкой "выбора папки" разные папки.

    После выбора папки для ресурса определяется количество медиафайлов в папке.
    После выбора папки для ресурса определяется наличие права на запись в эту папку.
    Если сетевая папка не найдена, она всё равно присутствует в списке на добавление, но с текстом ("не найдена").
    Если права доступа к папке не полные, она всё равно присутствует в списке на добавление, но с текстом о недостатке прав.

    3.2.6 После работы сканирования или при успешном закрытии диалога "выбор папки" (при выбранной папке) ниже должен появиться (пополниться) "Список папок (ресурсов) к добавлению".
    Список состоит из найденных при сканировании или добавленных вручную ресурсов. Он состоит из набора следующих полей:
    * галочка "Добавить". Пользователь может снять её, если не хочет добавить этот ресурс, по умолчанию она включена.
    * короткое название из имени IP\имя папки, которое пользователь может отредактировать.
    * количество найденных медиафайлов внутри.
    * галочка "В destinations", но только для папок, которые доступны для записи. По умолчанию она выключена. Пользователь может установить её вручную для каждой строки списка перед следующим шагом.

    После работы сканирования или ручного добавления папок, если список не пустой, под списком появляется кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".

    По нажатию этой кнопки в список папок (ресурсов) программы добавляются все невыключенные пользователем ресурсы из списка "к добавлению" с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы передаем в главный экран необходимость вывести предупреждения.
    После чего возврат в "Main Screen".

    **3.3 Облачная папка:**

    3.3.1 Набор кнопок "Google Drive", "One Drive", "Dropbox". По нажатию на такие кнопки - авторизация и выбор. Вызывает диалог авторизации у выбранного провайдера облачных ресурсов и выбора там на хранилище папки для добавления.

    3.3.2 При успешном закрытии диалога "выбор папки" (при выбранной папке) ниже должен появиться (пополниться) "Список папок (ресурсов) к добавлению".
    Список состоит из добавленных вручную ресурсов. Он состоит из набора следующих полей:
    * галочка "Добавить". Пользователь может снять её, если не хочет добавить этот ресурс, по умолчанию она включена.
    * короткое название из имени "Облачный провайдер\имя папки", которое пользователь может отредактировать.
    * количество найденных медиафайлов внутри.
    * галочка "В destinations", но только для папок, которые доступны для записи. По умолчанию она выключена. Пользователь может установить её вручную для каждой строки списка перед следующим шагом.

    После ручного добавления папок, если список не пустой, под списком появляется кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".

    По нажатию этой кнопки в список папок (ресурсов) программы добавляются все невыключенные пользователем ресурсы из списка "к добавлению" с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы передаем в главный экран необходимость вывести предупреждения.

    После чего возврат в "Main Screen".

    **3.4 SFTP:**

    3.4.1 Поле имени ресурса в сети, поле "короткое имя ресурса".

    3.4.2 В одну строку поля "пользователь", "пароль", "порт".
    Если поля пустые, то программа принимает пользователя и пароль, введённые в настройках программы. Если в настройках программы нет сохраненных пользователя и пароля - их нужно подчеркнуть красным, потребовать от пользователя их ввести. Порт стоит по умолчанию для SMTP-подключений, но пользователь может изменить.

    3.4.3 Галочка "Добавить к destinations". Выключена по умолчанию.

    3.4.4 Кнопка "Тест" для проверки доступа к SFTP-ресурсу.
    В результате пользователь получает диалог с подробным описанием доступа к данному SFTP-ресурсу. У этого диалога, помимо кнопки ОК, есть кнопка "скопировать в буфер" для текста диагностики.

    3.4.5 Кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".
    По нажатию этой кнопки в список папок (ресурсов) программы добавляется этот SFTP-ресурс с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы позволяем пользователю добавлять папку, даже если она недоступна, но передаем в главный экран необходимость вывести предупреждения типа "ресурс недоступен" или "недостаточно прав".

    После чего возврат в "Main Screen".

Все новые папки по умолчанию сохраняются с флажками "поддержки всех типов медиафайлов".
Все новые папки по умолчанию сохраняются с интервалом слайд-шоу по умолчанию или взятым из настроек программы.

#### Экран профиля ресурса
На этом экране пользователь видит все поля данных, присущие папке (ресурсу). Я перечислил их выше в описании термина "папка (ресурс)".
Здесь они представлены в виде списка полей (для редактирования или выбора) и текстов (информация).
В этой "карточке" ресурса пользователь, разумеется, не может поменять для ресурса его тип, уникальный идентификатор, его дату создания, число найденных медиафайлов. Но остальное доступно для редактирования. В том числе редакция адреса ресурса.

В этом окне пользователь может определить для папки (ресурса) длительность слайд-шоу, а также какие типы медиафайлов будут учитываться в этой папке.

В экране есть кнопки "Назад", "Тест", "Сброс", "Сохранить".
"Назад" - обычная отмена любых изменений и возврат в предыдущий экран.
"Тест" - диалог тестирования ресурса в зависимости от его типа, таким, каким он выполнен при вызове из "экрана добавления и сканирования ресурсов".
"Сброс" - отмена всех изменений в текстовых полях, что сделал пользователь (перечитать из базы данных).
"Сохранить" - сохранить измененные данные в базу данных и закрыть этот экран.

#### "Экран фильтрации и сортировки списка папок ресурсов"
Это небольшой диалог с кнопками "применить" и "отмена", в котором пользователь может:

* выпадающим списком выбрать вариант сортировки (указаны выше), применимый к наименованию папки (ресурса).
* с помощью блока галочек отфильтровать типы ресурсов.
* с помощью блока галочек отфильтровать ресурсы по типам поддерживаемых медиафайлов.
* текстовое поле "по части наименования". Оно пустое, но если пользователь введет тут какой-то текст, то нужно отобрать только ресурсы, в которых либо в коротком наименовании, либо в полном адресе встречается этот текст (как участок) без учета регистра букв.

При закрытии этого диалога по кнопке "Применить" - сортировка и фильтры применяются к списку ресурсов на основном экране. При применении фильтра на этом экране внизу появляется предупреждение с текстом описания примененного фильтра.

#### экран Browse Screen
Это рабочий экран программы. Он довольно сложный, так как его состав будет зависеть от настроек программы, настроек выбранного ресурса, прав на доступ к ресурсу.
Идея такова - пользователь видит списком или таблицей медиафайлы одной папки (ресурса). У него есть возможность изменять сортировку, скролить, листать. Он может выбирать один или несколько медиафайлов для доступных операций. Он может начинать проигрывание медиафайла или слайдшоу, начиная с этого медиафайла.

Внешний вид: наверху панель управления, ряд кнопок в виде иконок: 
* "Назад"
* небольшой пробел,
* "Сортировка". Вызывает диалог выбора сортировки медиафайлов в папке с "применить" и "отмена". Режим сортировки первоначально берется по-умолчанию из настроек программы. И сохраняется для каждого ресурса.
* "Фильтр". Вызывает диалог для фильтрации медиафайлов в папке с "применить" и "отмена". В диалоге фильтрации пользователь может внести часть наименования файла (без учета регистра букв), может ввести условие для даты создания файлов >=Date;<=Date, может ввести условие для размера медиафайлов >=Mb; <=Mb. Фильтрация не сохраняется для ресурса (папки) после того, как пользоваткель выходит тз Browse Screen назад.
* Кнопка переключения вида сетка/список. Вид сохраняется для папки (ресурса).
* Кнопка "копировать..". Видна, если не отключена в настойках ив программе задан хоть один destination и это destination не текущая папка (ресурс). Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "копировать в..".
* Кнопка "переместить..". Видна если не отключена в настойках и в программе задан хоть один destination и это destination не текущая папка (ресурс). И если у нас есть права на запись в текущу папку (ресурс), для удаления файла после перемещения. Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "переместить в..".
* Кнопка "переименовать..". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс). Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "переименовать в..".
* Кнопка "удалить". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс). Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "удалить".
* Кнопка иконкой "отменить операцию". Видна, если включена в настройках - запускает процес отмены последней операции (копирования, перемещения, переимнования, удаления). Если последней операции нет - копка disabled.
* небольшой пробел,
* Кнопка начала проигрывания в (экран проигрывателя в режиме слайд-шоу) с текущего выбранного медиафайла (первого, если ни один не выбран) в установленном сортировкой последовательности.
Высота кнопок уменьшена вдвое, если применено условие "Маленькие элементы управления" в настройках.

* небольшой текстовый заголовок с названием папки (ресурса) и её полным адресом, Счетчик выбранных медиайайлов.

Ниже идет список или таблица (сетка) медиафайлов.
Для списка каждый медиафайл представлен в виде 
* строки из иконки файла (размер из настроек) или, если применено условие "Маленькие элементы управления" в настройках, то пользователь видит иконку расширения медиафайла.
* Далее в строке наименование файла,
* размер файла относительных величинах (гигабайт, мегабайт, килобайт) с 1 знаком после запятой
* дата создания файла
* Кнопка иконкой копировать. Видна если не отключена в настойках ив программе задан хоть один destination и это destination не текущая папка (ресурс).
* Кнопка иконкой "переместить..". Видна если не отключена в настойках и в программе задан хоть один destination и это destination не текущая папка (ресурс). И если у нас есть права на запись в текущу папку (ресурс), для удаления файла после перемещения.
* Кнопка иконкой "переименовать..". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс).
* Кнопка иконкой "удалить". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс).
* небольшой пробел,
* Кнопка иконкой начала проигрывания текущего выбранного медиафайла (экран проигрывателя) в установленном сортировкой последовательности.

Если пользователь один раз нажимает в списке на медиафайл по иконке/изображению, имени, дате, размеру или кнопка начала проигрывания -  этот файл выбирается и для него запускается экран проигрывателя.

Если пользователь долго жмет на медиафайл (но не по кнопкам), то 
1. если не один файл не был фыбран до этого, то этот файл становится выбранным, но для него не запускается "экран проигрывателя".
2. Все файлы между текущим и педдыдущим выбранным файлом добавляются к выбранным. Так пользователь может прокручивая список или сетку отметить выбранными все неообходимыее для операции медиафайлы.

Выбраные файлы подсвечиваются в списке. Их число написано в текстовом заголовке. 
Если выбран один или несколько файлов, то пользователь может нажать кнопки команды "скопировать", "переместить", "переименовать" или "удалить" для выбранных файлов (по их доступности).

#### диалог-экран "копировать в.."
На этом экране пользователь видит 
1. Заголовок "копирование N файлов из [название папки источника]
2. Серия кнопок от 1 до 10 из destinations в зависимости от числа доступных для копирования destinations. То есть все destinations, за исключением текущей папки (ресурса).
3. Кнопка отмена.
Кнопки destinations в порядке и с цветом, как это задано в списке получателей.
Кнопки destinations динамического размера и занимают доступное место.
При нажатии на эту кнопку выделенный медиафайл или список медиафайлов будет скопирован в папку-получатель. Если процесс длится более двух секунд, то нужен прогресс-бар. После копирования нужно всплывающее сообщение "скопировано N файлов".
Учитывать настройки копирования перезаписывать или пропускать файлы при их наличии.
После копирования, если было выделено несколько файлов, выделеным остаётся последний или, если настройка программы "после копирования перейти на следующий файл" установлена, - следующий.
Фон формы - темнозеленый для темной цветовой схемы и светлозеленый для светлой.
При ошибках копирования нужны всплывающие сообщения об этом даже в release-версии программы.
Результат копирования хранится в памяти до следующей операции с файлами. Необходим, чтобы произвести "отмену операции" по специальной команде. Любая следущая операция - это перемещение, переименование, удаление, выход из списка, просмотр (проигрывание) другого файла.

#### диалог-экран "переместить в.."
На этом экране пользователь видит 
1. Заголовок "перемещение N файлов из [название папки источника]
2. Серия кнопок от 1 до 10 из destinations в зависимости от числа доступных для копирования destinations. То есть все destinations, за исключением текущей папки (ресурса).
3. Кнопка отмена.
Кнопки destinations в порядке и с цветом, как это задано в списке получателей.
Кнопки destinations динамического размера и занимают доступное место.
При нажатии на эту кнопку выделенный медиафайл или список медиафайлов будет перенесён в папку-получатель. Если процесс длится более двух секунд, то нужен прогресс-бар. После копирования нужно всплывающее сообщение "скопировано N файлов".
Учитывать настройки переноса перезаписывать или пропускать файлы при их наличии.
После переноса, если было выделеным остаётся следущий файл за последним выделеным.
Фон формы - темносиний для темной цветовой схемы и светлосиний для светлой.
При ошибках перемещения нужны всплывающие сообщения об этом даже в release-версии программы.
Результат перемещения хранится в памяти до следующей операции с файлами. Необходим, чтобы произвести "отмену операции" по специальной команде. Любая следущая операция - это копирование, переименование, удаление, выход из списка, просмотр (проигрывание) другого файла.

#### диалог-экран "переименовать в.."
На этом экране пользователь видит 
1. Заголовок "переименование N файлов из [название папки источника]
2.1 Для одного выбранного файла - поле "Наименование" со значением текущего наименования с расширением. Доступное для редакции.
2.2 Для нескольких выбранных файлов - список из именований медиафайлов (с расширениями), доступный для редакции пользователю.
3. Кнопки "применить" и "отмена".
При "применить" файл или список файлов переименовывается (если имя было изменено). Если файл с таким именем уже существует, то переименование следует пропустить и нужно всплывающее сообщение "файл [имя] с таким именем уже существует - пропущен".
Фон формы - темножелтый для темной цветовой схемы и светложелтый для светлой.
При ошибках переименования нужны всплывающие сообщения об этом даже в release-версии программы.
Результат переименований хранится в памяти до следующей операции с файлами. Необходим, чтобы произвести "отмену операции" по специальной команде. Любая следущая операция - это копирование, перемещение, удаление, выход из списка, просмотр (проигрывание) другого файла.

#### диалог-экран "удалить"
Диалог демонстрируется только для случаея, когда стоит настройка "Подтверждать удаление".
В диалоге для одного выбранного файла текст запроса "Ву уверены что хотите удалить файл [имя] из [название папки источника]?
В диалоге для нескольких выбранных файлов текст запроса "Ву уверены что хотите удалить [N] файлов из [название папки источника]?
Фон формы - темнокрасный для темной цветовой схемы и светлокрасный для светлой.
При ошибках удаления нужны всплывающие сообщения об этом даже в release-версии программы.
Если в настройках включена отмена операций, то файл (файлы) сразу физически не удаляются, а только пропадают из списка (сетки таблицы). Но они удаляются физически при любой следующей операции, кроме собственно отмены. Любая следущая операция - это копирование, перемещение, переименование, выход из списка, просмотр (проигрывание) другого файла.

#### Экран проигрывателя
На этом экране демонстрируется (проигрывается выбранный медиафайл).
При загрузке файла дольше одной секунды, нужно показать прогресс-бар загрузки.
После загрузки файла, как только пользователю проигрывается (демонстрируется) медиафайл и независимо от того включен ли режим слайдшоу нужно запустить на фоне загрузку следующего по списку файла, если следующий по списку файл статическое или анимированое изображение. Если пользователь перейдет к следующему файлу - то ему будет продемонстрирован уже загруженный файл.

Состав элементов экрана зависит от типа проигрываемого файла.
1. Для статического изображения:
1.1 Для полноэкранного режима (в настройках программы):
Файл демонстрируется на полный экран с сохраннием оригинальных пропорций изображения. При наклоне устройства, картинка должна так же "поворачиваться" вслед за устройством, растянутая на полный экран с сохраннием оригинальных пропорций изображения. Экран над картинкой разбит на 9 тач-зон. Три строки по три тач-зоны. Тач зоны невидимы при демонстрации изображения, но они продемонстрированы как карта в документации.
1.1.1 Левый верхний угол 30% от ширины экрана, 30% от высоты экрана - область команды "Назад" (белая зона).
1.1.2 Верх экрана - 40% по ширине после области "Назад", 30% от высоты экрана - область команды "скопировать" (зеленая зона).
1.1.3 Правый верхний угол экрана - 30% по ширине после области "скопировать", 30% от высоты экрана - область команды "переименовать" (желтая зона).
1.1.4 Левая часть экрана 30% от ширины экрана, 40% от высоты экрана после области "Назад" - область команды "предыдущий" (оранжевая зона).
1.1.5 Центр экрана. 40% от ширины экрана после зоны "предыдущий", 40% от высоты после области "скопировать" - область команды "перемещение" (синяя зона).
1.1.6 Правая часть экрана 30% от ширины экрана после зоны "перемещение", 40% от высоты после области "переименовать" - область команды "следующий" (фиолетовая зона).
1.1.7 Левый низ экрана - 30% по ширине, 30% от высоты экрана после зоны "предыдущий" - область команды "показать панель команд" (серая зона).
1.1.8 Низ экрана - 40% по ширине после зоны "показать панель команд", 30% от высоты экрана после зоны "переименовать" - область команды "удалить" (красная зона).
1.1.9 Правый низ экрана - 30% по ширине после зоны "удалить", 30% от высоты экрана после зоны "следующий" - область команды "слайдшоу" (розовая зона).

Описание реакции программы при нажатии по областям:
"Назад" - обратно к Browse Screen.
"Скопировать" - вызов диалог-экрана "копировать в.." для текущего демонстрирующегося файла
"Предыдущий" - переход (демонстрация, проигрывание предыдцщего медиафайла) в списке файлов ресурса по принятой в нём сортировке.
"Перемещение" - вызов диалог-экрана "переместить в.." для текущего демонстрирующегося файла
"Следующий" - переход (демонстрация, проигрывание следующего медиафайла) в списке файлов ресурса по принятой в нём сортировке.
"Показать панель команд". Демонстрация изображения переходит к виду "с панелью команд".
"Удалить". Вызов диалог-экрана "удалить" для текущего демонстрирующегося файла.
"Слайдшоу" - всплывающее окно с сообщением, что включен режим слайдшоу с указанием интервала. Запуск смены медиафайлов в режиме слайдшоу. Остановка режима слайдшоу - при нажатии любой области экрана, кроме Следующий. В режиме слайдшоу кнопка "следующий" демонстрирует следующий файл, сбрасывает отсчет интервала, но не останавливает слайдшоу.

1.2 Для режима "с панелью команд"
В этом режиме изображение не занимает весь экран. Над изображением появляется панель команд: "Назад", "предыдущий", "следующий", небольшое отступ, "переименовать", "удалить", "отменить", небольшой отступ, "слайдшоу".

А под изображением появлются ещё две панели команд "Копировать в.." и "Переместить в..".
Такие панели это от 1 до 10 кнопок в зависимости от числа доступных для копирования получателей. Не более 5 кнопок в ширину экрана
Если кнопка одна - на всю ширину экрана. 
Если кнопки две - по 1/2 от ширины экрана.
Если кнопки три - по 1/3 от ширины экрана.
Если кнопки четыре - по 1/4 от ширины экрана.
Если кнопок пять - по 1/5 от ширины экрана.
Если кнопок шесть - две строки по три кнопки по 1/3 от ширины экрана.
Если кнопок семь - две строки (четыре и три кнопки) по 1/4 и 1/3 от ширины экрана соответственно.
Если кнопок восемь - две строки по четыре кнопки по 1/4 от ширины экрана.
Если кнопок девять - две строки (пять и четыре кнопки) по 1/5 и 1/4 от ширины экрана соответственно.
Если кнопок десять - две строки по пять кнопок по 1/5 от ширины экрана.
Цвет и порядок из списка получателей.
Одна панель с заголовком "копировать в..".
Вторая панель с заголовком "переименовать в..".
Заголовки и текст кнопок дожен мыть маленьким и сохранять больше места для деонстрации медиафайла

В этом режиме само изображение накрыто всего двумя областями тач-зонами. Левая половина - зона "предыдущий". Правая половина - зона "следующий".

Если установлена настройка "маленькие элементы интерфейса" - все кнопки в два раза меньше по высоте, отдавая больше пространства изображению.

2. Для анимированого изображения:
Всё так-же как и для статического изображения, но при этом проигрывается без остановки анимация.

3. Для видео:
3.1 Полноэкранное проигрывание (отключена настройка демонстрации панели команд")
Видео проигрывается плеером, команды контроля видео-плеера появлюятся по нажатии на видеофайл, но в нижней области. 
Элементы управления: Стандартный набор (Play/Pause, полоса прокрутки)
Следовательно области тач-зоны (описаны для изображений) накрывают не всю область экрана, а уменьшены пропорционально на лишь 75 высоты.

3.2 Для режима "с панелью команд"
В этом режиме область проигрывания видео не занимает весь экран. Над ним появляется панель команд (как описано для статического изображения) и под ним формируются группы команд "скопировать в" и "переместить в" (как описано для статического изображения). Область видеоплейра накрыта двумя тач-зонами "предыдущий" и "следующий", но только верхние 50% области видеоплеера, чтобы в ннижней половине у пользователя оставалась возможность управлять внутренними контролами видеоплеера.

4. Для аудио:
Опишу мои пожелания к аудиоплейру - желательно чтобы интерфейс был близок к прогрывателю видео. Внизу был контрол внутренних команд, а над ним - перечень различных характеристик медиафайла и аудиопотока.
Элементы управления: Стандартный набор (Play/Pause, полоса прокрутки). Соответственно тогда области команд и тач-зон будут такими же, как и у видеоплеера.

В режиме слайдшоу медиафайлы демонстрируются один за другим по заданному интервалу. За три секунды до перехода к следующему файлу в правом верхнем углу появляются надписи "3..", "2..", "1.." перед сменой файла.
Видео и аудиофайлы, согласно установленной настройке должны проиграть до конца перед переходом к следующему файлу, проигрывание которого начинается автоматически.

Разумеется все команды операций (скопировать, переместить, переименовать, удалить, отменить) должны быть видны и доступны только если включены в настройках и могут быть применены к текущему файлу (если получатели и необходимые права доступа).


#### Settings Screen

Экран настроек программы.
Переход между закладками настроек мгновенный, без листания.
Настройки в виде закладок разделены на "Общие", "Медиафайлы", "Демонстрация и сортировка", "Destinations". При первом запуске настроек пользователь начинает с закладки "Общие". Затем программа хранит, с какой закладки пользователь покинул этот экран, и при открытии - открывает её.

**1. Общие**

1.1 Язык программы. Выбор между Английским, Русским, Украинским. Если пользователь сменил язык - его нужно попросить "перезапустить" приложение.

1.2 Галочка "Not allow device to sleep". По умолчанию включена. С этой настройкой программа не позволяет переходить устройству в режим блокировки (сна), пока запущена.

1.3 Галочка "Показывать маленькие элементы управления". По умолчанию выключена.

1.4 Поля "Пользователь по умолчанию" и "Пароль по умолчанию". Если они не были заданы (пустые для сетевой папки (ресурса) или SFTP), то программа применяет их из настроек.

1.5 Кнопка вызова User Guide, которая откроет Welcome Screen.

1.6 Кнопка вызова диалога получения прав "на работу с локальными файлами Android".
* После нажатия и работы кнопки у пользователя запрашивается разрешение на перезапуск программы.
* Если право уже есть, то кнопка неактивна (Disabled).

1.7 Кнопка вызова диалога получения прав "на работу с внешней сетью SFTP".
* После нажатия и работы кнопки у пользователя запрашивается разрешение на перезапуск программы.
* Если право уже есть, то кнопка неактивна (Disabled).

1.8 Кнопка "Показать лог". Вызывает диалог с текстовым полем, в который попадает полный лог, ограниченный либо тремя последними сессиями, либо 512 строками. С кнопками "Скопировать в буфер" и "Закрыть".

1.9 Кнопка "Показать лог текущей сессии" с кнопками "Скопировать в буфер" и "Закрыть".

1.10 Текстовое описание текущей версии программы, версии сборки, интерактивный e-mail разработчика - sza@ukr.net

**2. Медиафайлы**

2.1 Галочка "Поддержка статических изображений" с перечислением всех поддерживаемых типов.
По умолчанию включена.
Под ней подчинённое поле "Лимит размера изображений". Здесь нужен двойной бегунок с минимальным и максимальным значениями. Бегунок от 0 до 1Gb. По умолчанию выбран от 1Kb до 10Mb.
Установленный лимит применяется при сканировании числа медиафайлов и при их проигрывании.

2.2 Галочка "Поддержка анимации GIF".
По умолчанию выключена.

2.3 Галочка "Поддержка видео" с перечислением всех поддерживаемых форматов.
По умолчанию включена.
Под ней подчинённое поле "Лимит размера видеофайлов". Здесь нужен двойной бегунок с минимальным и максимальным значениями. Бегунок от 0 до 1Tb. По умолчанию выбран от 100Kb до 1Gb.
Установленный лимит применяется при сканировании числа медиафайлов и при их проигрывании.

2.4 Галочка "Поддержка аудио" с перечислением всех поддерживаемых форматов.
По умолчанию включена.
Под ней подчинённое поле "Лимит размера аудиофайлов". Здесь нужен двойной бегунок с минимальным и максимальным значениями. Бегунок от 0 до 10Gb. По умолчанию выбран от 10Kb до 100Mb.
Установленный лимит применяется при сканировании числа медиафайлов и при их проигрывании.

**3. Демонстрация и сортировка**
3.1 Режим сортировки медиафайлов при проигрывании по умолчанию. По-умолчанию: по наименованию.

3.2 Интервал слайд-шоу в секундах по умолчанию. От 1 до 3600. При установке пересчитывает в минуты и демонстрирует текстом рядом.

3.3 Галочка "Проигрывать видео и аудио до конца, перед демонстрацией следующего файла в режиме слайд-шоу".

3.4 Галочка "Разрешить переименование". По умолчанию включена.

3.5 Галочка "Разрешить удаление". По умолчанию включена.
Плюс подчинённая ей галочка "Запрашивать подтверждение пользователя перед удалением". По умолчанию включена.

3.6 Галочка "Медиафайлы в виде сетки по-умолчанию". По умолчанию выключена.

3.7 Размеры иконки файла (а так же ячейки сетки) по-умолчанию. Начальное значение - 100 на 100.

3.8 Галочка "Демонстрировать медиафайлы в полноэкранном режиме (иначе - с панелью команд)". По умолчанию включена.

3.9 Галочка "Показывать детальные сообщения об ошибках операций и проигрывания медиафайлов". По умолчанию выключена.
Если эта галочка включена, то вместо всплывающего сообщения об ошибке, пользователю будет демонстрироваться окно диалога с подробным текстом текущего состояния и сообщения об ошибке с кнопками "скопировать в буфер" и "закрыть".

**4. Destinations.**

4.1 Галочка "Включить копирование". По умолчанию включена.
Подчиненные ей галочки:
 "Переходить на следующий файл после копирования". По умолчанию включена.
 "Перезаписывать существующий файл при копировании". По умолчанию выключена.

4.2 Галочка "Включить перенос". По умолчанию включена.
Подчиненная ей галочка: "Перезаписывать существующий файл при переносе". По умолчанию выключена.

4.3 Пронумерованный список до 10 элементов. С нумерацией от 0 до 9. Это ресурсы-получатели. Здесь их можно перемещать в списке вверх и вниз и удалять. Еще по кнопке "Добавить получателя" можно выбрать его из числа зарегистрированных ресурсов (если этот ресурс ещё не выбран в получатели). Эта кнопка доступна, только если ресурсов-получателей меньше 10. Если список получателей не помещается на экран, появляется прокрутка.
У каждого получателя свой цвет, согласно его номеру. Этим цветом будут подсвечены кнопки в режиме проигрывания медиафайлов. Здесь мы видим короткое имя ресурса, которое будет написано на кнопках, и полный адрес ресурса.

---

### 1.3. Functional Specification

1.3. Functional Specification
1.3.1. Основные принципы
1.3.1.1. Единый интерфейс: Приложение предоставляет единый интерфейс для работы с медиафайлами из локальных и сетевых источников, объединяя функции просмотра, слайд-шоу и сортировки в одном экране (Browse Screen).
1.3.1.2. Поддерживаемые типы медиа:
Изображения: JPEG, PNG.
Анимация: GIF.
Видео: MP4, WEBM, MOV, MKV (с использованием ExoPlayer).
Аудио: MP3, WAV и другие форматы, поддерживаемые плеером.
1.3.1.3. Цветовая схема: Приложение автоматически адаптируется под системную тему устройства (светлую или темную).
1.3.1.4. Локализация: Интерфейс поддерживает английский, русский и украинский языки. Язык по умолчанию определяется настройками системы, с возможностью ручного переключения.

1.3.2. Управление ресурсами (папками)
1.3.2.1. Типы ресурсов: Система поддерживает 4 типа ресурсов: "Локальная папка", "Сетевая папка (SMB)", "Облачная папка" (Google Drive, OneDrive, Dropbox) и "SFTP".
1.3.2.2. Добавление и сканирование:
Локальные: Ручное добавление через системный диалог выбора папки или автоматическое сканирование устройства для поиска папок с медиа (включая стандартные папки Android).
Сетевые (SMB): Добавление через указание IP-адреса, учетных данных и имени ресурса. Реализована функция сканирования общих папок на указанном хосте.
Облачные: Добавление через диалог авторизации соответствующего облачного провайдера.
SFTP: Добавление через указание хоста, порта и учетных данных.
1.3.2.3. Главный экран:
Отображение всех зарегистрированных ресурсов в виде списка с возможностью прокрутки.
Для каждого ресурса отображается имя, адрес, тип, количество медиафайлов и отметка о принадлежности к Destinations.
Пользователь может изменять порядок ресурсов в списке, редактировать (вызов Экрана профиля ресурса), копировать и удалять ресурсы.
Доступны функции фильтрации и сортировки списка ресурсов.
Навигация: короткое нажатие выбирает ресурс, длинное или двойное нажатие открывает Browse Screen.

1.3.3. Просмотр и навигация по медиафайлам (Browse Screen)
1.3.3.1. Режимы отображения:
Список: Отображение файлов построчно с иконкой и детальной информацией (имя, размер, дата).
Сетка: Отображение файлов в виде таблицы с иконками, размер которых настраивается.
1.3.3.2. Сортировка и фильтрация:
Сортировка: Применяется к списку файлов по имени (алфавитному и логическому), размеру, дате создания, длительности. Выбранный порядок сохраняется для ресурса.
Фильтрация: Временная фильтрация списка по части имени, диапазону дат создания или размеру файла.
1.3.3.3. Выбор файлов:
Поддерживается выбор одного или нескольких файлов для выполнения пакетных операций.
Длинное нажатие на файл инициирует режим множественного выбора.

1.3.4. Операции с файлами
1.3.4.1. Основные операции: Копирование, перемещение, переименование, удаление. Доступность операций зависит от прав доступа к ресурсу и настроек приложения.
1.3.4.2. Destinations (Получатели):
Операции копирования и перемещения выполняются в одну из предварительно настроенных папок-получателей (до 10).
Выбор получателя осуществляется через специализированные диалоги (диалог-экран "копировать в.." и диалог-экран "переместить в.."), где каждому Destination соответствует цветная кнопка.
1.3.4.3. Переименование: Поддерживается переименование как одного, так и нескольких файлов.
1.3.4.4. Удаление:
Операция требует подтверждения, если это включено в настройках.
При включенной опции "отмены", физическое удаление файла откладывается до следующей операции пользователя.
1.3.4.5. Отмена операции:
Опциональная функция, включаемая в настройках.
Позволяет отменить последнюю файловую операцию (копирование, перемещение, переименование, удаление). Система хранит информацию о последней операции для возможности ее отката.

1.3.5. Проигрыватель медиа (Экран проигрывателя)
1.3.5.1. Режимы демонстрации:
Полноэкранный: Медиафайл отображается на весь экран. Управление осуществляется через невидимые сенсорные зоны (тач-зоны) для навигации и вызова операций.
С панелью команд: Над и под медиафайлом отображаются панели с кнопками управления и списками Destinations.
1.3.5.2. Навигация: Переход к предыдущему/следующему файлу осуществляется свайпами или через тач-зоны/кнопки.
1.3.5.3. Слайд-шоу:
Автоматическая смена файлов с настраиваемым интервалом.
Для видео и аудио файлов предусмотрена опция проигрывания до конца перед переходом к следующему.
1.3.5.4. Особенности типов медиа:
Изображения: Изображение растягивается для заполнения области отображения с сохранением исходных пропорций.
Видео: Используется ExoPlayer со стандартными элементами управления (play/pause, перемотка).
Аудио: Интерфейс, аналогичный видеоплееру, с отображением характеристик файла.
1.3.5.5. Кеширование: Реализовано упреждающее кеширование следующего файла в списке для ускорения навигации.

1.3.6. Настройки (Settings Screen)
1.3.6.1. Структура: Настройки сгруппированы по вкладкам: "Общие", "Медиафайлы", "Демонстрация и сортировка", "Destinations".
1.3.6.2. Ключевые настройки:
Общие: Выбор языка, управление режимом сна устройства, учетные данные по умолчанию для сетевых ресурсов, доступ к логам.
Медиафайлы: Включение/отключение поддержки типов медиа (изображения, видео, аудио, GIF) и установка лимитов по размеру для каждого типа.
Демонстрация и сортировка: Настройки сортировки по умолчанию, интервал слайд-шоу, включение/отключение файловых операций (удаление, переименование), режим отображения по умолчанию (полноэкранный/с панелями).
Destinations: Управление списком папок-получателей, их порядком и цветами. Включение/отключение операций копирования и переноса, настройка поведения при перезаписи файлов.

### 1.4. Non-Functional Specification

1.4.1. Производительность
Время отклика интерфейса: Любая операция, длящаяся более 1-2 секунд (загрузка файла, копирование, перемещение, сканирование), должна сопровождаться индикатором прогресса.
Плавность навигации: Для обеспечения быстрой смены изображений в режиме проигрывателя/слайд-шоу должен быть реализован механизм упреждающего кеширования следующего по списку медиафайла.

1.4.2. Совместимость
Версии ОС: Приложение должно корректно функционировать на Android версии 9.0 и выше.
Адаптация функций: Для функций, которые не могут быть реализованы на устаревших версиях Android (начиная с 9.0), необходимо предусмотреть их отключение или альтернативную реализацию, обеспечив сборку версии с урезанной функциональностью.
Системная тема: Приложение должно автоматически применять светлую или темную тему в соответствии с текущими настройками устройства.

1.4.3. Надежность и обработка ошибок
Обработка ошибок: Должна быть реализована устойчивая обработка ошибок, возникающих при работе с файлами и сетью (нестабильное соединение, отсутствие доступа, поврежденные файлы).
Логирование:
Release-версия: Логируются только критические ошибки.
Debug-версия: Ведется полное логирование всех операций для упрощения отладки.
Доступ к логам: Пользователь должен иметь доступ к логам текущей сессии, а также к сводному логу за последние 3 сессии (объемом не более 512 строк) через меню настроек.
Детализация ошибок: В настройках должна быть опция для отображения детальных диалоговых окон об ошибках вместо кратких всплывающих сообщений.

1.4.4. Миграция данных
Отсутствие миграции: Приложение версии 2 является самостоятельным продуктом. Миграция настроек и данных из версии 1 не поддерживается. Пользователю потребуется выполнить настройку с нуля.

1.4.5. Требования к публикации
Google Play: Приложение должно соответствовать всем актуальным требованиям и политикам Google Play Store для успешной публикации

1.4.6 Цветовую тему программа заимствует принимает из системной для устройства при запуске.

### 1.5. Technology Stack Selection

1.5.1. Технологии, переносимые из v1
Kotlin: Основной язык программирования. Обеспечивает современный синтаксис и безопасность типов.
Android View System: Традиционный подход к построению UI с использованием XML-разметки. Сохраняется для преемственности и работы с существующими Activity и Fragment.
Room Persistence Library: Компонент Android Jetpack для создания и управления локальной базой данных SQLite. Используется для хранения списка ресурсов, destinations и настроек.
ExoPlayer: Медиаплеер от Google для воспроизведения видео и аудио форматов. Выбран за гибкость, расширяемость и поддержку сетевых потоков.

1.5.2. Новые технологии для v2
Kotlin Coroutines & Flow: Стандарт для управления асинхронными операциями (сетевые запросы, доступ к БД, файловые операции), обеспечивая отзывчивость UI.
Android Architecture Components:
ViewModel: Для хранения и управления UI-related данными, переживая изменения конфигурации.
Navigation Component: Для реализации и стандартизации навигации между экранами, решая проблему логических нестыковок при переходах.
Hilt: Рекомендованная Google библиотека для внедрения зависимостей. Упрощает управление зависимостями и улучшает тестируемость кода.
smbj: Современная Java-библиотека для работы с протоколом SMBv2/v3. Необходима для доступа к сетевым папкам в локальной сети.
sshj: Библиотека для реализации SFTP-клиента, необходимая для доступа к SFTP-ресурсам.
Cloud Storage APIs:
Google Drive API: Для интеграции с Google Drive.
Microsoft Graph API: Для интеграции с OneDrive.
Dropbox API: Для интеграции с Dropbox.

### 1.6. Risk Assessment

технические — совместимость с Android 9+, сетевые сбои
неюридические — обработка данных в облаке
временные — задержки интеграции ExoPlayer

## Phase 2: Environment and Repository Setup

### 2.1. Repository Setup

Описана в файле V2_p2_1.md

### 2.2. Development Environment Setup

Описана в файле V2_p2_2.md

### 2.3. Project Structure Initialization

Описана в файле V2_p2_3.md

### 2.4. CI/CD Pipeline Setup

Описана в файле V2_p2_4.md

### 2.5. Development Tools Configuration

Описана в файле V2_p2_5.md

## Phase 3: Detailed Development Planning

### 3.1. Architecture Design

Реализация архитектуры, описанной в V2_architecture_overview.md, выполняется пошагово для каждой новой функциональности.

#### Шаг 1: Настройка базовых компонентов (пакет `core`)
1.  Создать базовые классы для UI: `BaseActivity`, `BaseFragment`, `BaseViewModel`. Эти классы будут содержать общую логику, такую как обработка состояний (загрузка, ошибка), внедрение зависимостей и подписка на `ViewModel`.
2.  Настроить Hilt для внедрения зависимостей. Создать класс Application, аннотированный `@HiltAndroidApp`.
3.  Создать основные модули Hilt в пакете `core.di` для предоставления общепроектных зависимостей (например, `Context`, `SharedPreferences`, `DispatcherProvider`).

#### Шаг 2: Определение Domain Layer
1.  В пакете `domain.model` определить POKO-классы (Plain Old Kotlin Objects), представляющие основные бизнес-сущности (например, `MediaFile`, `MediaResource`).
2.  В пакете `domain.repository` определить интерфейсы для репозиториев (например, `ResourceRepository`, `SettingsRepository`). Эти интерфейсы будут служить контрактом для слоя данных.
3.  Для каждой бизнес-операции создать класс `UseCase` в пакете `domain.usecase` (например, `GetResourcesUseCase`, `UpdateResourceUseCase`). `UseCase` должен зависеть только от интерфейсов репозиториев.

#### Шаг 3: Реализация Data Layer
1.  В пакете `data.local.db` определить компоненты Room: `Entity` классы (аннотированные `@Entity`), `DAO` интерфейсы (аннотированные `@Dao`) и класс `AppDatabase` (наследуемый от `RoomDatabase`).
2.  В пакете `data.remote` реализовать клиенты для работы с сетевыми протоколами (SMB, SFTP) и облачными API.
3.  В пакете `data.repository` создать классы, реализующие интерфейсы репозиториев из `domain.repository`. Эти классы будут инкапсулировать логику выбора источника данных (локальный или удаленный) и маппинг моделей данных (из `Entity`/DTO в доменные модели).

#### Шаг 4: Реализация UI Layer (для одной фичи)
1.  В пакете `ui` создать подпакет для новой фичи (например, `ui.main`).
2.  Создать `Fragment` (например, `MainFragment`), который будет наследоваться от `BaseFragment`.
3.  Создать `ViewModel` (например, `MainViewModel`), который будет наследоваться от `BaseViewModel`. Внедрить в него необходимые `UseCases` через конструктор с аннотацией `@HiltViewModel`.
4.  Во `ViewModel` определить `StateFlow` для состояния экрана и `SharedFlow` для одноразовых событий (например, навигация, показ Toast).
5.  В `Fragment` подписаться на `Flow` из `ViewModel` для обновления UI и передавать события пользователя в `ViewModel`.
6.  Создать XML-layout для `Fragment` и, при необходимости, `Adapter` для `RecyclerView`.

#### Шаг 5: Интеграция и тестирование
1.  Добавить созданный `Fragment` в граф навигации Navigation Component.
2.  Написать Unit-тесты для `ViewModel`, `UseCases` и репозиториев, используя mock-объекты для зависимостей.
3.  Написать инструментальные тесты для проверки корректности работы UI и взаимодействия компонентов.


### 3.2. Milestone Planning

Описана в файле V2_p3_2.md

### 3.3. Data Model Design

Описана в файле V2_p3_3.md

### 3.4. Documentation Planning

Описана в файле V2_p3_4.md

## Phase 4: Implementation and Iteration

### 4.1. Core Implementation

TODO:

### 4.2. Reference v1 Code

Использовать v1 как справочник.

## Phase 5: Testing, Release, and Maintenance

### 5.1. Quality Assurance

TODO:

### 5.2. Release Preparation

TODO:

### 5.3. Launch and Post-Launch

TODO:
