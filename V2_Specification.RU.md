# V2 Specification

This file contains detailed specifications for FastMediaSorter v2, corresponding to the plan items in Version2_todo.md.

## Phase 1: Discovery and Specification

### 1.1. Define Core Concept & Goals

#### TERMS:

Прочитайте файл V2_TERMS.md

#### The primary goals for v2.:

Прочитайте файл V2_p1_1.md

### 1.2. UI/UX Design

#### Welcome Screen
Запускается при первом запуске программы после установки и по кнопке из экрана настроек.
Выглядит как сменяющиеся несколько страниц с инструкциями и описанием программы. Есть кнопка "Skip", которая закрывает это окно, даже если пользователь не пролистал его до конца.

#### Main Screen
Основной экран программы.
На нём пользователю видны и доступны следующие элементы (в зависимости от настроек):

1.  Список зарегистрированных "папок" (ресурсов). В этом списке каждый ресурс должен быть представлен в виде строки, содержащей:
    * короткое имя ресурса,
    * полный адрес ресурса (очень мелким шрифтом),
    * тип ресурса,
    * число медиафайлов ресурса (определенное при добавлении или при последнем открытии в Browse Screen или последнем сканировании),
    * отметка, если ресурс также в списке destinations
    * коротко по первым буквам о типах медиафайлов, которые пользователь определил для папки ("I"mage, "V"ideo, "A"udio, "G"if (animations)),
    * кнопка открытия "экрана профиля ресурса" для его редактирования (в виде иконки "edit")
    * кнопки "вверх" и "вниз" (в виде иконок "стрелочек") для перемещения позиции ресурса в списке,
    * кнопка удаления папки (ресурса) из списка (в виде иконки "мусорная корзина")

    Размер списка папок (ресурсов) должен быть динамический. Сначала он будет пустой, но когда он не будет помещаться на экран с учетом прочих элементов, он должен иметь полосу прокрутки.

    В списке папок (ресурсов) может быть выбран только один. После открытия Main Screen должен быть подсвечен последний выбранный ресурс. Если ресурс был удален, никакой ресурс не должен быть выбран. Пользователю нужно его выбрать.

    Кнопка удаления ресурса из списка должна вызывать диалог "Вы согласны удалить ресурс?" или (если это так) "Вы согласны удалить destination?". Если пользователь ответил "ДА", то запись об этом ресурсе удаляется.

    Если пользователь коротко нажимает на строку папки (ресурса), то он просто подсвечивается и становится выбранным. Как только у нас есть выбранная папка-ресурс, кнопки "Запустить проигрыватель" и "Копирование ресурса" становятся активны (enabled).

    Если пользователь "долго нажимает на ресурс" (длинное нажатие), он вызывает Browse Screen для этого ресурса.

    Если пользователь "дважды нажимает на ресурс" (двойной клик), он вызывает Browse Screen для этого ресурса.

    Если новый ресурс в список был только что добавлен вручную, он должен быть сразу выбран. Если добавленные ресурсы - это результаты работы сканирования, то они не должны быть выбраны автоматически.

    Важно помнить, что практически все вызываемые отсюда экраны могут изменить состав и данные этого экрана во время своего закрытия.

2.  Кнопки управления этим списком папок (ресурсов). Расположены в одну строку над списком, которая занимает 100% ширины:
    * Кнопка "Запустить проигрыватель" в виде иконки "PLAY" двойного размера.
        Вызывает Browse Screen для выбранного ресурса.
        Если ни один ресурс не выбран в списке, то кнопка "Запустить проигрыватель" неактивна (disabled).
    * Кнопка "Добавление ресурса" в виде иконки "большой Плюс".
        Вызывает "экран добавления и сканирования ресурсов".
    * Кнопка "Копирование ресурса" в виде иконки "копирование".
        Вызывает "экран добавления и сканирования ресурсов" с учетом выбранного ресурса.
        Если ни один ресурс не выбран в списке, то кнопка "Копирование ресурса" неактивна (disabled).
        В отличие от кнопки "создания" при копировании все значения для нового ресурса берутся с текущего выбранного ресурса из списка. Пользователю необходимо только задать изменения (отличия от оригинала).
    * Небольшой пробел между кнопками.
    * Кнопка "фильтр и сортировка" в виде иконки "фильтр".
        Вызывает "экран фильтрации и сортировки списка папок ресурсов".
        При применении фильтра на основном экране внизу появляется предупреждение с текстом описания примененного фильтра.
    * Кнопка "обновить" в виде иконки "обновить".
        Вызывает процедуру обновления (пересканирования существующих папок).
    * Небольшой пробел между кнопками.
    * Кнопка перехода к Settings Screen в виде иконки "Settings".
        Вызывает Settings Screen.
    * Кнопка выхода из программы (её закрытия) в виде иконки "Exit Door".

#### Экран добавления и сканирования ресурсов
На этом экране пользователь должен ввести детали новой записи о папке-ресурсе.
При копировании из существующего ресурса все значения для нового ресурса берутся с текущего выбранного ресурса из списка. Пользователю необходимо только задать изменения (отличия от оригинала). То есть при копировании тип ресурса не меняется.

Элементы:
1.  Кнопка "Назад", для отмены добавления и возврата на "Main Screen".

2.  Выбор типа ресурса.
    Для этого нужен удобный элемент интерфейса:
    * опция "Локальная папка" (доступна для нажатия, если пользователь дал право на локальные папки, иначе просто видна, но неактивна)
    * опция "Сетевая папка"
    * опция "Облачная папка"
    * опция "SFTP" (доступна для нажатия, если пользователь дал право на связь с интернетом)

3.  Затем, ниже, в зависимости от типа ресурса будут различные элементы:

    **3.1 Для локальной папки:**

    3.1.1 Кнопка с иконкой лупы и надписью "SCAN" и текстом описания рядом "Добавить все локальные папки с медиа".
    Вызывает процедуру сканирования доступных локальных папок с наличием медиафайлов. Найденные ресурсы попадают в список "ресурсы к добавлению".
    Есть предопределённые папки Android - Download, photos, movies, Camera. Нужно определить, какие есть на этом устройстве. Если этих предопределенных папок ещё нет в списке ресурсов (например, при сканировании впервые), то их нужно добавить в список "ресурсы к добавлению", даже если внутри них нет медиафайлов.
    Остальные папки устройства нужно просканировать на наличие медиафайлов и, если они есть, добавить в список "ресурсы к добавлению" с названием папки (например, от Telegram или Whatsapp). Нужно проверять, что папки, которые добавляются к списку "ресурсы к добавлению", ещё не зарегистрированы в списке папок (ресурсов).

    Во время сканирования появляется всплывающее сообщение "Сканирование локальных папок...".
    Во время сканирования определяется количество медиафайлов в папке.
    Во время сканирования определяется право на запись в эту папку.

    3.1.2 Кнопка с иконкой "выбора папки" и надписью "добавить вручную" и текстом описания "Указать папку вручную".
    При вызове этой кнопки нужен диалог Android для выбора локальной папки. Если пользователь выбрал папку в диалоге, ниже кнопки должен появиться "Список папок (ресурсов) к добавлению".
    В этот список одну за другой пользователь может добавлять кнопкой "выбора папки" разные папки.

    После выбора папки для ресурса определяется количество медиафайлов в папке.
    После выбора папки для ресурса определяется наличие права на запись в эту папку.

    3.1.3 После работы сканирования или при успешном закрытии диалога "выбор папки" (при выбранной папке) ниже должен появиться (пополниться) "Список папок (ресурсов) к добавлению".
    Список состоит из найденных при сканировании или добавленных вручную ресурсов. Он состоит из набора следующих полей:
    * галочка "Добавить". Пользователь может снять её, если не хочет добавить этот ресурс, по умолчанию она включена.
    * короткое название из имени папки, которое пользователь может отредактировать.
    * количество найденных медиафайлов внутри.
    * галочка "В destinations", но только для папок, которые доступны для записи. По умолчанию она выключена. Пользователь может установить её вручную для каждой строки списка перед следующим шагом.

    После работы сканирования или ручного добавления папок, если список не пустой, под списком появляется кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".

    По нажатию этой кнопки в список папок (ресурсов) программы добавляются все невыключенные пользователем ресурсы из списка "к добавлению" с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы передаем в главный экран необходимость вывести предупреждения.
    После чего возврат в "Main Screen".

    **3.2 Для сетевой папки (в локальной сети):**

    3.2.1 Поле для ввода IP машины.
    Поле должно быть заполнено автоматически по данным IP этого Android-устройства. Например, если IP 192.168.1.100, то мы пользователю сразу заполняем поле как "192.168.1." с курсором в конце строки. В поле пользователь может вносить только цифры и точку. Но если он вводит запятую - распознается сразу как точка. Если он вводит любые другие символы - они игнорируются. Если он вводит четвертую точку - ввод игнорируется. Если он пытается ввести четырехзначное число - ввод блокируется. В общем, нужно удобное поле ввода IP-адреса. Ссылка "помощи к полю" должна вести на поисковик Google сразу со строкой "Как определить IP моего компьютера во внутренней сети?".

    3.2.2 В одну строку поля "пользователь" и "пароль".
    Если поля пустые, то программа принимает пользователя и пароль, введённые в настройках программы. Если в настройках программы нет сохраненных пользователя и пароля - поля нужно подчеркнуть красным, потребовать от пользователя их ввести.

    3.2.3 Кнопка "Тест" для проверки доступа к IP.
    В результате пользователь получает диалог с подробным описанием сетевого доступа к данному IP. У этого диалога, помимо кнопки ОК, есть кнопка "скопировать в буфер" для текста диагностики.

    3.2.4 В той же строке с кнопкой "Тест", ещё одна - Кнопка с иконкой лупы и надписью "SCAN" и текстом описания рядом "Добавить все открытые сетевые папки с этого компьютера".

    Вызывает процедуру сканирования доступных сетевых папок, независимо от наличия в них медиафайлов. Найденные ресурсы попадают в список "ресурсы к добавлению", если этих папок ещё нет в списке ресурсов программы.
    Предопределённые административные папки (типа $C) игнорируются.

    Во время сканирования появляется всплывающее сообщение "Сканирование сетевых папок...".
    Во время сканирования определяется количество медиафайлов в папке.
    Во время сканирования определяется право на запись в эту папку.

    3.2.5 Третья кнопка в той же строке с иконкой "выбора папки" и надписью "добавить вручную" и текстом описания "Указать папку вручную".
    При вызове этой кнопки нужен диалог для ввода текстового значения адреса папки. С кнопками "Добавить" и "Отмена".
    В диалоге должно быть понятно, что IP-адрес уже не нужно вводить и какие-либо прямые или обратные слеши. В диалоге выгодно сделать выпадающий список с именами папок, найденными на этом компьютере. Но пользователь, вероятнее всего, захочет ввести подпапку или адрес вручную.
    Так, например, если пользователь регистрирует новый ресурс "192.168.1.100\Common\Images", то текст "192.168.1.100\" должен быть информационным заголовком, текст "Common\" может выпадать в качестве одной из папок, найденных на этом компьютере. А текст "Images" пользователь уже должен ввести сам.

    После того, как пользователь указал папку в диалоге, который он закрывает кнопкой "Добавить", ресурс должен появиться в списке "Список папок (ресурсов) к добавлению".
    В этот список одну за другой пользователь может добавлять кнопкой "выбора папки" разные папки.

    После выбора папки для ресурса определяется количество медиафайлов в папке.
    После выбора папки для ресурса определяется наличие права на запись в эту папку.
    Если сетевая папка не найдена, она всё равно присутствует в списке на добавление, но с текстом ("не найдена").
    Если права доступа к папке не полные, она всё равно присутствует в списке на добавление, но с текстом о недостатке прав.

    3.2.6 После работы сканирования или при успешном закрытии диалога "выбор папки" (при выбранной папке) ниже должен появиться (пополниться) "Список папок (ресурсов) к добавлению".
    Список состоит из найденных при сканировании или добавленных вручную ресурсов. Он состоит из набора следующих полей:
    * галочка "Добавить". Пользователь может снять её, если не хочет добавить этот ресурс, по умолчанию она включена.
    * короткое название из имени IP\имя папки, которое пользователь может отредактировать.
    * количество найденных медиафайлов внутри.
    * галочка "В destinations", но только для папок, которые доступны для записи. По умолчанию она выключена. Пользователь может установить её вручную для каждой строки списка перед следующим шагом.

    После работы сканирования или ручного добавления папок, если список не пустой, под списком появляется кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".

    По нажатию этой кнопки в список папок (ресурсов) программы добавляются все невыключенные пользователем ресурсы из списка "к добавлению" с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы передаем в главный экран необходимость вывести предупреждения.
    После чего возврат в "Main Screen".

    **3.3 Облачная папка:**

    3.3.1 Набор кнопок "Google Drive", "One Drive", "Dropbox". По нажатию на такие кнопки - авторизация и выбор. Вызывает диалог авторизации у выбранного провайдера облачных ресурсов и выбора там на хранилище папки для добавления.

    3.3.2 При успешном закрытии диалога "выбор папки" (при выбранной папке) ниже должен появиться (пополниться) "Список папок (ресурсов) к добавлению".
    Список состоит из добавленных вручную ресурсов. Он состоит из набора следующих полей:
    * галочка "Добавить". Пользователь может снять её, если не хочет добавить этот ресурс, по умолчанию она включена.
    * короткое название из имени "Облачный провайдер\имя папки", которое пользователь может отредактировать.
    * количество найденных медиафайлов внутри.
    * галочка "В destinations", но только для папок, которые доступны для записи. По умолчанию она выключена. Пользователь может установить её вручную для каждой строки списка перед следующим шагом.

    После ручного добавления папок, если список не пустой, под списком появляется кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".

    По нажатию этой кнопки в список папок (ресурсов) программы добавляются все невыключенные пользователем ресурсы из списка "к добавлению" с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы передаем в главный экран необходимость вывести предупреждения.

    После чего возврат в "Main Screen".

    **3.4 SFTP:**

    3.4.1 Поле имени ресурса в сети, поле "короткое имя ресурса".

    3.4.2 В одну строку поля "пользователь", "пароль", "порт".
    Если поля пустые, то программа принимает пользователя и пароль, введённые в настройках программы. Если в настройках программы нет сохраненных пользователя и пароля - их нужно подчеркнуть красным, потребовать от пользователя их ввести. Порт стоит по умолчанию для SMTP-подключений, но пользователь может изменить.

    3.4.3 Галочка "Добавить к destinations". Выключена по умолчанию.

    3.4.4 Кнопка "Тест" для проверки доступа к SFTP-ресурсу.
    В результате пользователь получает диалог с подробным описанием доступа к данному SFTP-ресурсу. У этого диалога, помимо кнопки ОК, есть кнопка "скопировать в буфер" для текста диагностики.

    3.4.5 Кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу".
    По нажатию этой кнопки в список папок (ресурсов) программы добавляется этот SFTP-ресурс с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка-ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.

    Мы позволяем пользователю добавлять папку, даже если она недоступна, но передаем в главный экран необходимость вывести предупреждения типа "ресурс недоступен" или "недостаточно прав".

    После чего возврат в "Main Screen".

Все новые папки по умолчанию сохраняются с флажками "поддержки всех типов медиафайлов".
Все новые папки по умолчанию сохраняются с интервалом слайд-шоу по умолчанию или взятым из настроек программы.

#### Экран профиля ресурса
На этом экране пользователь видит все поля данных, присущие папке (ресурсу). Я перечислил их выше в описании термина "папка (ресурс)".
Здесь они представлены в виде списка полей (для редактирования или выбора) и текстов (информация).
В этой "карточке" ресурса пользователь, разумеется, не может поменять для ресурса его тип, уникальный идентификатор, его дату создания, число найденных медиафайлов. Но остальное доступно для редактирования. В том числе редакция адреса ресурса.

В этом окне пользователь может определить для папки (ресурса) длительность слайд-шоу, а также какие типы медиафайлов будут учитываться в этой папке.

В экране есть кнопки "Назад", "Тест", "Сброс", "Сохранить".
"Назад" - обычная отмена любых изменений и возврат в предыдущий экран.
"Тест" - диалог тестирования ресурса в зависимости от его типа, таким, каким он выполнен при вызове из "экрана добавления и сканирования ресурсов".
"Сброс" - отмена всех изменений в текстовых полях, что сделал пользователь (перечитать из базы данных).
"Сохранить" - сохранить измененные данные в базу данных и закрыть этот экран.

#### "Экран фильтрации и сортировки списка папок ресурсов"
Это небольшой диалог с кнопками "применить" и "отмена", в котором пользователь может:

* выпадающим списком выбрать вариант сортировки (указаны выше), применимый к наименованию папки (ресурса).
* с помощью блока галочек отфильтровать типы ресурсов.
* с помощью блока галочек отфильтровать ресурсы по типам поддерживаемых медиафайлов.
* текстовое поле "по части наименования". Оно пустое, но если пользователь введет тут какой-то текст, то нужно отобрать только ресурсы, в которых либо в коротком наименовании, либо в полном адресе встречается этот текст (как участок) без учета регистра букв.

При закрытии этого диалога по кнопке "Применить" - сортировка и фильтры применяются к списку ресурсов на основном экране. При применении фильтра на этом экране внизу появляется предупреждение с текстом описания примененного фильтра.

#### экран Browse Screen
Это рабочий экран программы. Он довольно сложный, так как его состав будет зависеть от настроек программы, настроек выбранного ресурса, прав на доступ к ресурсу.
Идея такова - пользователь видит списком или таблицей медиафайлы одной папки (ресурса). У него есть возможность изменять сортировку, скролить, листать. Он может выбирать один или несколько медиафайлов для доступных операций. Он может начинать проигрывание медиафайла или слайдшоу, начиная с этого медиафайла.

Внешний вид: наверху панель управления, ряд кнопок в виде иконок: 
* "Назад"
* небольшой пробел,
* "Сортировка". Вызывает диалог выбора сортировки медиафайлов в папке с "применить" и "отмена". Режим сортировки первоначально берется по-умолчанию из настроек программы. И сохраняется для каждого ресурса.
* "Фильтр". Вызывает диалог для фильтрации медиафайлов в папке с "применить" и "отмена". В диалоге фильтрации пользователь может внести часть наименования файла (без учета регистра букв), может ввести условие для даты создания файлов >=Date;<=Date, может ввести условие для размера медиафайлов >=Mb; <=Mb. Фильтрация не сохраняется для ресурса (папки) после того, как пользоваткель выходит тз Browse Screen назад.
* Кнопка переключения вида сетка/список. Вид сохраняется для папки (ресурса).
* Кнопка "копировать..". Видна, если не отключена в настойках ив программе задан хоть один destination и это destination не текущая папка (ресурс). Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "копировать в..".
* Кнопка "переместить..". Видна если не отключена в настойках и в программе задан хоть один destination и это destination не текущая папка (ресурс). И если у нас есть права на запись в текущу папку (ресурс), для удаления файла после перемещения. Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "переместить в..".
* Кнопка "переименовать..". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс). Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "переименовать в..".
* Кнопка "удалить". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс). Если ни один файл ниже в списке/сетке не выбран - disabled. Вызывает диалог-экран "удалить".
* Кнопка иконкой "отменить операцию". Видна, если включена в настройках - запускает процес отмены последней операции (копирования, перемещения, переимнования, удаления). Если последней операции нет - копка disabled.
* небольшой пробел,
* Кнопка начала проигрывания в (экран проигрывателя в режиме слайд-шоу) с текущего выбранного медиафайла (первого, если ни один не выбран) в установленном сортировкой последовательности.
Высота кнопок уменьшена вдвое, если применено условие "Маленькие элементы управления" в настройках.

* небольшой текстовый заголовок с названием папки (ресурса) и её полным адресом, Счетчик выбранных медиайайлов.

Ниже идет список или таблица (сетка) медиафайлов.
Для списка каждый медиафайл представлен в виде 
* строки из иконки файла (размер из настроек) или, если применено условие "Маленькие элементы управления" в настройках, то пользователь видит иконку расширения медиафайла.
* Далее в строке наименование файла,
* размер файла относительных величинах (гигабайт, мегабайт, килобайт) с 1 знаком после запятой
* дата создания файла
* Кнопка иконкой копировать. Видна если не отключена в настойках ив программе задан хоть один destination и это destination не текущая папка (ресурс).
* Кнопка иконкой "переместить..". Видна если не отключена в настойках и в программе задан хоть один destination и это destination не текущая папка (ресурс). И если у нас есть права на запись в текущу папку (ресурс), для удаления файла после перемещения.
* Кнопка иконкой "переименовать..". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс).
* Кнопка иконкой "удалить". Видна если не отключена в настойках и у нас есть права на запись в текущу папку (ресурс).
* небольшой пробел,
* Кнопка иконкой начала проигрывания текущего выбранного медиафайла (экран проигрывателя) в установленном сортировкой последовательности.

Если пользователь один раз нажимает в списке на медиафайл по иконке/изображению, имени, дате, размеру или кнопка начала проигрывания -  этот файл выбирается и для него запускается экран проигрывателя.

Если пользователь долго жмет на медиафайл (но не по кнопкам), то 
1. если не один файл не был фыбран до этого, то этот файл становится выбранным, но для него не запускается "экран проигрывателя".
2. Все файлы между текущим и педдыдущим выбранным файлом добавляются к выбранным. Так пользователь может прокручивая список или сетку отметить выбранными все неообходимыее для операции медиафайлы.

Выбраные файлы подсвечиваются в списке. Их число написано в текстовом заголовке. 
Если выбран один или несколько файлов, то пользователь может нажать кнопки команды "скопировать", "переместить", "переименовать" или "удалить" для выбранных файлов (по их доступности).

#### диалог-экран "копировать в.."
На этом экране пользователь видит 
1. Заголовок "копирование N файлов из [название папки источника]
2. Серия кнопок от 1 до 10 из destinations в зависимости от числа доступных для копирования destinations. То есть все destinations, за исключением текущей папки (ресурса).
3. Кнопка отмена.
Кнопки destinations в порядке и с цветом, как это задано в списке получателей.
Кнопки destinations динамического размера и занимают доступное место.
При нажатии на эту кнопку выделенный медиафайл или список медиафайлов будет скопирован в папку-получатель. Если процесс длится более двух секунд, то нужен прогресс-бар. После копирования нужно всплывающее сообщение "скопировано N файлов".
Учитывать настройки копирования перезаписывать или пропускать файлы при их наличии.
После копирования, если было выделено несколько файлов, выделеным остаётся последний или, если настройка программы "после копирования перейти на следующий файл" установлена, - следующий.
Фон формы - темнозеленый для темной цветовой схемы и светлозеленый для светлой.
При ошибках копирования нужны всплывающие сообщения об этом даже в release-версии программы.
Результат копирования хранится в памяти до следующей операции с файлами. Необходим, чтобы произвести "отмену операции" по специальной команде. Любая следущая операция - это перемещение, переименование, удаление, выход из списка, просмотр (проигрывание) другого файла.

#### диалог-экран "переместить в.."
На этом экране пользователь видит 
1. Заголовок "перемещение N файлов из [название папки источника]
2. Серия кнопок от 1 до 10 из destinations в зависимости от числа доступных для копирования destinations. То есть все destinations, за исключением текущей папки (ресурса).
3. Кнопка отмена.
Кнопки destinations в порядке и с цветом, как это задано в списке получателей.
Кнопки destinations динамического размера и занимают доступное место.
При нажатии на эту кнопку выделенный медиафайл или список медиафайлов будет перенесён в папку-получатель. Если процесс длится более двух секунд, то нужен прогресс-бар. После копирования нужно всплывающее сообщение "скопировано N файлов".
Учитывать настройки переноса перезаписывать или пропускать файлы при их наличии.
После переноса, если было выделеным остаётся следущий файл за последним выделеным.
Фон формы - темносиний для темной цветовой схемы и светлосиний для светлой.
При ошибках перемещения нужны всплывающие сообщения об этом даже в release-версии программы.
Результат перемещения хранится в памяти до следующей операции с файлами. Необходим, чтобы произвести "отмену операции" по специальной команде. Любая следущая операция - это копирование, переименование, удаление, выход из списка, просмотр (проигрывание) другого файла.

#### диалог-экран "переименовать в.."
На этом экране пользователь видит 
1. Заголовок "переименование N файлов из [название папки источника]
2.1 Для одного выбранного файла - поле "Наименование" со значением текущего наименования с расширением. Доступное для редакции.
2.2 Для нескольких выбранных файлов - список из именований медиафайлов (с расширениями), доступный для редакции пользователю.
3. Кнопки "применить" и "отмена".
При "применить" файл или список файлов переименовывается (если имя было изменено). Если файл с таким именем уже существует, то переименование следует пропустить и нужно всплывающее сообщение "файл [имя] с таким именем уже существует - пропущен".
Фон формы - темножелтый для темной цветовой схемы и светложелтый для светлой.
При ошибках переименования нужны всплывающие сообщения об этом даже в release-версии программы.
Результат переименований хранится в памяти до следующей операции с файлами. Необходим, чтобы произвести "отмену операции" по специальной команде. Любая следущая операция - это копирование, перемещение, удаление, выход из списка, просмотр (проигрывание) другого файла.

#### диалог-экран "удалить"
Диалог демонстрируется только для случаея, когда стоит настройка "Подтверждать удаление".
В диалоге для одного выбранного файла текст запроса "Ву уверены что хотите удалить файл [имя] из [название папки источника]?
В диалоге для нескольких выбранных файлов текст запроса "Ву уверены что хотите удалить [N] файлов из [название папки источника]?
Фон формы - темнокрасный для темной цветовой схемы и светлокрасный для светлой.
При ошибках удаления нужны всплывающие сообщения об этом даже в release-версии программы.
Если в настройках включена отмена операций, то файл (файлы) сразу физически не удаляются, а только пропадают из списка (сетки таблицы). Но они удаляются физически при любой следующей операции, кроме собственно отмены. Любая следущая операция - это копирование, перемещение, переименование, выход из списка, просмотр (проигрывание) другого файла.

#### Экран проигрывателя
На этом экране демонстрируется (проигрывается выбранный медиафайл).
При загрузке файла дольше одной секунды, нужно показать прогресс-бар загрузки.
После загрузки файла, как только пользователю проигрывается (демонстрируется) медиафайл и независимо от того включен ли режим слайдшоу нужно запустить на фоне загрузку следующего по списку файла, если следующий по списку файл статическое или анимированое изображение. Если пользователь перейдет к следующему файлу - то ему будет продемонстрирован уже загруженный файл.

Состав элементов экрана зависит от типа проигрываемого файла.
1. Для статического изображения:
1.1 Для полноэкранного режима (в настройках программы):
Файл демонстрируется на полный экран с сохраннием оригинальных пропорций изображения. При наклоне устройства, картинка должна так же "поворачиваться" вслед за устройством, растянутая на полный экран с сохраннием оригинальных пропорций изображения. Экран над картинкой разбит на 9 тач-зон. Три строки по три тач-зоны. Тач зоны невидимы при демонстрации изображения, но они продемонстрированы как карта в документации.
1.1.1 Левый верхний угол 30% от ширины экрана, 30% от высоты экрана - область команды "Назад" (белая зона).
1.1.2 Верх экрана - 40% по ширине после области "Назад", 30% от высоты экрана - область команды "скопировать" (зеленая зона).
1.1.3 Правый верхний угол экрана - 30% по ширине после области "скопировать", 30% от высоты экрана - область команды "переименовать" (желтая зона).
1.1.4 Левая часть экрана 30% от ширины экрана, 40% от высоты экрана после области "Назад" - область команды "предыдущий" (оранжевая зона).
1.1.5 Центр экрана. 40% от ширины экрана после зоны "предыдущий", 40% от высоты после области "скопировать" - область команды "перемещение" (синяя зона).
1.1.6 Правая часть экрана 30% от ширины экрана после зоны "перемещение", 40% от высоты после области "переименовать" - область команды "следующий" (фиолетовая зона).
1.1.7 Левый низ экрана - 30% по ширине, 30% от высоты экрана после зоны "предыдущий" - область команды "показать панель команд" (серая зона).
1.1.8 Низ экрана - 40% по ширине после зоны "показать панель команд", 30% от высоты экрана после зоны "переименовать" - область команды "удалить" (красная зона).
1.1.9 Правый низ экрана - 30% по ширине после зоны "удалить", 30% от высоты экрана после зоны "следующий" - область команды "слайдшоу" (розовая зона).

Описание реакции программы при нажатии по областям:
"Назад" - обратно к Browse Screen.
"Скопировать" - вызов диалог-экрана "копировать в.." для текущего демонстрирующегося файла
"Предыдущий" - переход (демонстрация, проигрывание предыдцщего медиафайла) в списке файлов ресурса по принятой в нём сортировке.
"Перемещение" - вызов диалог-экрана "переместить в.." для текущего демонстрирующегося файла
"Следующий" - переход (демонстрация, проигрывание следующего медиафайла) в списке файлов ресурса по принятой в нём сортировке.
"Показать панель команд". Демонстрация изображения переходит к виду "с панелью команд".
"Удалить". Вызов диалог-экрана "удалить" для текущего демонстрирующегося файла.
"Слайдшоу" - всплывающее окно с сообщением, что включен режим слайдшоу с указанием интервала. Запуск смены медиафайлов в режиме слайдшоу. Остановка режима слайдшоу - при нажатии любой области экрана, кроме Следующий. В режиме слайдшоу кнопка "следующий" демонстрирует следующий файл, сбрасывает отсчет интервала, но не останавливает слайдшоу.

1.2 Для режима "с панелью команд"
В этом режиме изображение не занимает весь экран. Над изображением появляется панель команд: "Назад", "предыдущий", "следующий", небольшое отступ, "переименовать", "удалить", "отменить", небольшой отступ, "слайдшоу".

А под изображением появлются ещё две панели команд "Копировать в.." и "Переместить в..".
Такие панели это от 1 до 10 кнопок в зависимости от числа доступных для копирования получателей. Не более 5 кнопок в ширину экрана
Если кнопка одна - на всю ширину экрана. 
Если кнопки две - по 1/2 от ширины экрана.
Если кнопки три - по 1/3 от ширины экрана.
Если кнопки четыре - по 1/4 от ширины экрана.
Если кнопок пять - по 1/5 от ширины экрана.
Если кнопок шесть - две строки по три кнопки по 1/3 от ширины экрана.
Если кнопок семь - две строки (четыре и три кнопки) по 1/4 и 1/3 от ширины экрана соответственно.
Если кнопок восемь - две строки по четыре кнопки по 1/4 от ширины экрана.
Если кнопок девять - две строки (пять и четыре кнопки) по 1/5 и 1/4 от ширины экрана соответственно.
Если кнопок десять - две строки по пять кнопок по 1/5 от ширины экрана.
Цвет и порядок из списка получателей.
Одна панель с заголовком "копировать в..".
Вторая панель с заголовком "переименовать в..".
Заголовки и текст кнопок дожен мыть маленьким и сохранять больше места для деонстрации медиафайла

В этом режиме само изображение накрыто всего двумя областями тач-зонами. Левая половина - зона "предыдущий". Правая половина - зона "следующий".

Если установлена настройка "маленькие элементы интерфейса" - все кнопки в два раза меньше по высоте, отдавая больше пространства изображению.

2. Для анимированого изображения:
Всё так-же как и для статического изображения, но при этом проигрывается без остановки анимация.

3. Для видео:
3.1 Полноэкранное проигрывание (отключена настройка демонстрации панели команд")
Видео проигрывается плеером, команды контроля видео-плеера появлюятся по нажатии на видеофайл, но в нижней области. 
Элементы управления: Стандартный набор (Play/Pause, полоса прокрутки)
Следовательно области тач-зоны (описаны для изображений) накрывают не всю область экрана, а уменьшены пропорционально на лишь 75 высоты.

3.2 Для режима "с панелью команд"
В этом режиме область проигрывания видео не занимает весь экран. Над ним появляется панель команд (как описано для статического изображения) и под ним формируются группы команд "скопировать в" и "переместить в" (как описано для статического изображения). Область видеоплейра накрыта двумя тач-зонами "предыдущий" и "следующий", но только верхние 50% области видеоплеера, чтобы в ннижней половине у пользователя оставалась возможность управлять внутренними контролами видеоплеера.

4. Для аудио:
Опишу мои пожелания к аудиоплейру - желательно чтобы интерфейс был близок к прогрывателю видео. Внизу был контрол внутренних команд, а над ним - перечень различных характеристик медиафайла и аудиопотока.
Элементы управления: Стандартный набор (Play/Pause, полоса прокрутки). Соответственно тогда области команд и тач-зон будут такими же, как и у видеоплеера.

В режиме слайдшоу медиафайлы демонстрируются один за другим по заданному интервалу. За три секунды до перехода к следующему файлу в правом верхнем углу появляются надписи "3..", "2..", "1.." перед сменой файла.
Видео и аудиофайлы, согласно установленной настройке должны проиграть до конца перед переходом к следующему файлу, проигрывание которого начинается автоматически.

Разумеется все команды операций (скопировать, переместить, переименовать, удалить, отменить) должны быть видны и доступны только если включены в настройках и могут быть применены к текущему файлу (если получатели и необходимые права доступа).


#### Settings Screen

Экран настроек программы.
Переход между закладками настроек мгновенный, без листания.
Настройки в виде закладок разделены на "Общие", "Медиафайлы", "Демонстрация и сортировка", "Destinations". При первом запуске настроек пользователь начинает с закладки "Общие". Затем программа хранит, с какой закладки пользователь покинул этот экран, и при открытии - открывает её.

**1. Общие**

1.1 Язык программы. Выбор между Английским, Русским, Украинским. Если пользователь сменил язык - его нужно попросить "перезапустить" приложение.

1.2 Галочка "Not allow device to sleep". По умолчанию включена. С этой настройкой программа не позволяет переходить устройству в режим блокировки (сна), пока запущена.

1.3 Галочка "Показывать маленькие элементы управления". По умолчанию выключена.

1.4 Поля "Пользователь по умолчанию" и "Пароль по умолчанию". Если они не были заданы (пустые для сетевой папки (ресурса) или SFTP), то программа применяет их из настроек.

1.5 Кнопка вызова User Guide, которая откроет Welcome Screen.

1.6 Кнопка вызова диалога получения прав "на работу с локальными файлами Android".
* После нажатия и работы кнопки у пользователя запрашивается разрешение на перезапуск программы.
* Если право уже есть, то кнопка неактивна (Disabled).

1.7 Кнопка вызова диалога получения прав "на работу с внешней сетью SFTP".
* После нажатия и работы кнопки у пользователя запрашивается разрешение на перезапуск программы.
* Если право уже есть, то кнопка неактивна (Disabled).

1.8 Кнопка "Показать лог". Вызывает диалог с текстовым полем, в который попадает полный лог, ограниченный либо тремя последними сессиями, либо 512 строками. С кнопками "Скопировать в буфер" и "Закрыть".

1.9 Кнопка "Показать лог текущей сессии" с кнопками "Скопировать в буфер" и "Закрыть".

1.10 Текстовое описание текущей версии программы, версии сборки, интерактивный e-mail разработчика - sza@ukr.net

**2. Медиафайлы**

2.1 Галочка "Поддержка статических изображений" с перечислением всех поддерживаемых типов.
По умолчанию включена.
Под ней подчинённое поле "Лимит размера изображений". Здесь нужен двойной бегунок с минимальным и максимальным значениями. Бегунок от 0 до 1Gb. По умолчанию выбран от 1Kb до 10Mb.
Установленный лимит применяется при сканировании числа медиафайлов и при их проигрывании.

2.2 Галочка "Поддержка анимации GIF".
По умолчанию выключена.

2.3 Галочка "Поддержка видео" с перечислением всех поддерживаемых форматов.
По умолчанию включена.
Под ней подчинённое поле "Лимит размера видеофайлов". Здесь нужен двойной бегунок с минимальным и максимальным значениями. Бегунок от 0 до 1Tb. По умолчанию выбран от 100Kb до 1Gb.
Установленный лимит применяется при сканировании числа медиафайлов и при их проигрывании.

2.4 Галочка "Поддержка аудио" с перечислением всех поддерживаемых форматов.
По умолчанию включена.
Под ней подчинённое поле "Лимит размера аудиофайлов". Здесь нужен двойной бегунок с минимальным и максимальным значениями. Бегунок от 0 до 10Gb. По умолчанию выбран от 10Kb до 100Mb.
Установленный лимит применяется при сканировании числа медиафайлов и при их проигрывании.

**3. Демонстрация и сортировка**
3.1 Режим сортировки медиафайлов при проигрывании по умолчанию. По-умолчанию: по наименованию.

3.2 Интервал слайд-шоу в секундах по умолчанию. От 1 до 3600. При установке пересчитывает в минуты и демонстрирует текстом рядом.

3.3 Галочка "Проигрывать видео и аудио до конца, перед демонстрацией следующего файла в режиме слайд-шоу".

3.4 Галочка "Разрешить переименование". По умолчанию включена.

3.5 Галочка "Разрешить удаление". По умолчанию включена.
Плюс подчинённая ей галочка "Запрашивать подтверждение пользователя перед удалением". По умолчанию включена.

3.6 Галочка "Медиафайлы в виде сетки по-умолчанию". По умолчанию выключена.

3.7 Размеры иконки файла (а так же ячейки сетки) по-умолчанию. Начальное значение - 100 на 100.

3.8 Галочка "Демонстрировать медиафайлы в полноэкранном режиме (иначе - с панелью команд)". По умолчанию включена.

3.9 Галочка "Показывать детальные сообщения об ошибках операций и проигрывания медиафайлов". По умолчанию выключена.
Если эта галочка включена, то вместо всплывающего сообщения об ошибке, пользователю будет демонстрироваться окно диалога с подробным текстом текущего состояния и сообщения об ошибке с кнопками "скопировать в буфер" и "закрыть".

**4. Destinations.**

4.1 Галочка "Включить копирование". По умолчанию включена.
Подчиненные ей галочки:
 "Переходить на следующий файл после копирования". По умолчанию включена.
 "Перезаписывать существующий файл при копировании". По умолчанию выключена.

4.2 Галочка "Включить перенос". По умолчанию включена.
Подчиненная ей галочка: "Перезаписывать существующий файл при переносе". По умолчанию выключена.

4.3 Пронумерованный список до 10 элементов. С нумерацией от 0 до 9. Это ресурсы-получатели. Здесь их можно перемещать в списке вверх и вниз и удалять. Еще по кнопке "Добавить получателя" можно выбрать его из числа зарегистрированных ресурсов (если этот ресурс ещё не выбран в получатели). Эта кнопка доступна, только если ресурсов-получателей меньше 10. Если список получателей не помещается на экран, появляется прокрутка.
У каждого получателя свой цвет, согласно его номеру. Этим цветом будут подсвечены кнопки в режиме проигрывания медиафайлов. Здесь мы видим короткое имя ресурса, которое будет написано на кнопках, и полный адрес ресурса.

---

### 1.3. Functional Specification

Смотри файл V2_p1_3.md

### 1.4. Non-Functional Specification

Смотри файл V2_p1_4.md

### 1.5. Technology Stack Selection

Смотри файл V2_p1_5.md

### 1.6. Risk Assessment

технические — совместимость с Android 9+, сетевые сбои
неюридические — обработка данных в облаке
временные — задержки интеграции ExoPlayer

## Phase 2: Environment and Repository Setup

### 2.1. Repository Setup

Описана в файле V2_p2_1.md

### 2.2. Development Environment Setup

Описана в файле V2_p2_2.md

### 2.3. Project Structure Initialization

Описана в файле V2_p2_3.md

### 2.4. CI/CD Pipeline Setup

Описана в файле V2_p2_4.md

### 2.5. Development Tools Configuration

Описана в файле V2_p2_5.md

## Phase 3: Detailed Development Planning

### 3.1. Architecture Design

Описана в файле V2_p3_1.md

### 3.2. Milestone Planning

Описана в файле V2_p3_2.md

### 3.3. Data Model Design

Описана в файле V2_p3_3.md

### 3.4. Documentation Planning

Описана в файле V2_p3_4.md

## Phase 4: Implementation and Iteration

### 4.1. Core Implementation

TODO:

### 4.2. Reference v1 Code

Использовать v1 как справочник.

## Phase 5: Testing, Release, and Maintenance

### 5.1. Quality Assurance

TODO:

### 5.2. Release Preparation

TODO:

### 5.3. Launch and Post-Launch

TODO:
